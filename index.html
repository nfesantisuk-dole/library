<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡∏®‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ö‡∏•‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç : ‡∏™‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏î‡∏≠‡∏¢‡∏´‡∏•‡πà‡∏≠</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    /* CSS ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î */
    body { box-sizing: border-box; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { height: 100%; width: 100%; }
    body { font-family: 'Sarabun', sans-serif; background: linear-gradient(135deg, #e8f5e9 0%, #fff3e0 100%); }
    .main-wrapper { width: 100%; max-width: 1200px; margin: 0 auto; padding: 15px; }
    .app-header { background: linear-gradient(135deg, #66bb6a 0%, #ffb74d 100%); padding: 30px; border-radius: 20px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); text-align: center; margin-bottom: 30px; position: relative; }
    .app-header h1 { color: #1b5e20; font-size: 2.5em; font-weight: 700; margin-bottom: 10px; }
    .app-header p { color: #2e7d32; font-size: 1.1em; }
    .connection-status { display: inline-block; padding: 8px 16px; border-radius: 20px; font-size: 0.9em; font-weight: 600; margin-top: 10px; }
    .status-connected { background: #c8e6c9; color: #2e7d32; }
    .status-disconnected { background: #ffcdd2; color: #c62828; }
    .status-syncing { background: #fff9c4; color: #f57f17; }
    
    .nav-container { display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; }
    .nav-button { flex: 1; min-width: 140px; padding: 15px 20px; background: white; border: none; border-radius: 15px; font-size: 1em; font-weight: 600; color: #2e7d32; cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); font-family: 'Sarabun', sans-serif; }
    .nav-button:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12); }
    .nav-button.active { background: linear-gradient(135deg, #81c784 0%, #ffcc80 100%); color: #1b5e20; }
    
    .admin-only { display: none !important; }
    .show-admin .admin-only { display: block !important; }
    .show-admin .nav-button.admin-only { display: block !important; } 
    
    .login-btn { position: absolute; top: 20px; right: 20px; background: white; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-weight: bold; color: #2e7d32; box-shadow: 0 2px 5px rgba(0,0,0,0.2); border: none; font-family: 'Sarabun', sans-serif;}
    .login-container { text-align: center; }
    .login-input { width: 100%; padding: 12px; margin: 10px 0; border: 2px solid #c8e6c9; border-radius: 10px; font-family: 'Sarabun'; font-size: 1.1em; text-align: center;}

    /* Copy CSS ‡πÄ‡∏î‡∏¥‡∏°‡∏°‡∏≤‡∏ß‡∏≤‡∏á */
    .content-section { display: none; }
    .content-section.active { display: block; }
    .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .dashboard-card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); transition: transform 0.3s; }
    .dashboard-card:hover { transform: translateY(-5px); }
    .dashboard-card h3 { color: #2e7d32; font-size: 1em; margin-bottom: 10px; font-weight: 500; }
    .dashboard-card .stat-number { color: #1b5e20; font-size: 2.5em; font-weight: 700; }
    .dashboard-card .stat-label { color: #66bb6a; font-size: 0.9em; margin-top: 5px; }
    .card-container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); margin-bottom: 30px; }
    .card-container h2 { color: #1b5e20; margin-bottom: 20px; font-size: 1.5em; }
    .form-layout { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 20px; }
    .input-group { display: flex; flex-direction: column; }
    .input-group label { color: #2e7d32; font-weight: 600; margin-bottom: 8px; font-size: 1em; }
    .input-group input, .input-group select, .input-group textarea { padding: 12px 15px; border: 2px solid #c8e6c9; border-radius: 10px; font-size: 1em; font-family: 'Sarabun', sans-serif; transition: border-color 0.3s; background: #fafafa; }
    .input-group input:focus, .input-group select:focus, .input-group textarea:focus { outline: none; border-color: #66bb6a; background: white; }
    .input-group textarea { resize: vertical; min-height: 80px; }
    .button-primary { padding: 15px 30px; border: none; border-radius: 10px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.3s; font-family: 'Sarabun', sans-serif; background: linear-gradient(135deg, #66bb6a 0%, #ffb74d 100%); color: #1b5e20; box-shadow: 0 4px 15px rgba(102, 187, 106, 0.3); }
    .button-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102, 187, 106, 0.4); }
    .button-primary:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }
    .button-secondary { background: #e8f5e9; color: #2e7d32; padding: 12px 25px; border: none; border-radius: 10px; font-size: 1em; font-weight: 600; cursor: pointer; transition: all 0.3s; font-family: 'Sarabun', sans-serif; }
    .button-secondary:hover { background: #c8e6c9; }
    .button-danger { background: #ffcdd2; color: #c62828; padding: 10px 20px; border: none; border-radius: 8px; font-size: 0.9em; font-weight: 600; cursor: pointer; transition: all 0.3s; font-family: 'Sarabun', sans-serif; }
    .button-danger:hover { background: #ef9a9a; }
    .button-success { background: #c8e6c9; color: #2e7d32; padding: 10px 20px; border: none; border-radius: 8px; font-size: 0.9em; font-weight: 600; cursor: pointer; transition: all 0.3s; font-family: 'Sarabun', sans-serif; }
    .button-success:hover { background: #a5d6a7; }
    .search-filters { display: flex; gap: 15px; flex-wrap: wrap; margin-bottom: 20px; }
    .search-input { flex: 1; min-width: 200px; padding: 12px 15px; border: 2px solid #c8e6c9; border-radius: 10px; font-size: 1em; font-family: 'Sarabun', sans-serif; }
    .data-table-wrapper { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); overflow-x: auto; }
    .data-tables { overflow-x: auto; padding-bottom: 10px; }
    table { width: 100%; border-collapse: collapse; min-width: 600px; }
    table th, table td { padding: 8px; font-size: 0.9em; text-align: left; white-space: nowrap; }
    .data-table tr:hover { background: #f1f8e9; }
    .action-button-group { display: flex; gap: 8px; flex-wrap: wrap; }
    .status-badge { padding: 6px 12px; border-radius: 20px; font-size: 0.85em; font-weight: 600; display: inline-block; }
    .status-available { background: #c8e6c9; color: #2e7d32; }
    .status-borrowed { background: #fff9c4; color: #f57f17; }
    .status-overdue { background: #ffcdd2; color: #c62828; }
    .status-returned { background: #b3e5fc; color: #01579b; }
    .empty-message { text-align: center; padding: 60px 20px; color: #66bb6a; }
    .empty-icon { font-size: 4em; margin-bottom: 20px; }
    .empty-message h3 { font-size: 1.5em; margin-bottom: 10px; }
    .chart-wrapper { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); margin-bottom: 30px; height: 400px; position: relative; }
    .chart-wrapper canvas { height: 100% !important; width: 100% !important; }
    .chart-wrapper h2 { color: #1b5e20; margin-bottom: 20px; font-size: 1.5em; }
    .book-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08); margin-bottom: 15px; transition: transform 0.3s; }
    .book-card:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12); }
    .book-card-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px; }
    .book-card-title { color: #1b5e20; font-size: 1.3em; font-weight: 600; margin-bottom: 5px; }
    .book-card-author { color: #66bb6a; font-size: 1em; }
    .book-card-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 10px; margin-bottom: 15px; }
    .book-card-info-item { font-size: 0.9em; color: #2e7d32; }
    .book-card-info-label { font-weight: 600; }
    .toast { position: fixed; top: 20px; right: 20px; padding: 15px 25px; border-radius: 10px; color: white; font-weight: 600; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); z-index: 9999; animation: slideIn 0.3s ease-out; }
    .toast-success { background: #66bb6a; }
    .toast-error { background: #ef5350; }
    .toast-warning { background: #ffa726; }
    @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: center; z-index: 9998; padding: 20px; }
    .modal-content { background: white; padding: 30px; border-radius: 15px; max-width: 600px; width: 90%; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2); }
    .modal-header { color: #1b5e20; font-size: 1.5em; font-weight: 700; margin-bottom: 15px; }
    .modal-body { color: #2e7d32; margin-bottom: 20px; line-height: 1.6; }
    .modal-buttons { display: flex; gap: 10px; justify-content: flex-end; }
    .loading-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(255, 255, 255, 0.9); display: flex; align-items: center; justify-content: center; z-index: 10000; }
    .loading-spinner { width: 50px; height: 50px; border: 5px solid #e8f5e9; border-top-color: #66bb6a; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    @media (max-width: 768px) { .form-layout { grid-template-columns: 1fr; } .nav-container { flex-direction: column; } .nav-button { width: 100%; } .dashboard-grid { grid-template-columns: 1fr; } .search-filters { flex-direction: column; } .search-input { width: 100%; } .data-table-wrapper { padding: 15px; } .data-table { font-size: 0.9em; } .data-table th, .data-table td { padding: 10px; } .action-button-group { flex-direction: column; } }
    .modal-content .input-group input, .modal-content .input-group select, .modal-content .input-group textarea { padding: 10px 15px; }
    @view-transition { navigation: auto; }
  </style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="main-wrapper" id="mainWrapper">
   <header class="app-header">
    <button id="adminLoginBtn" class="login-btn" onclick="showLoginModal()">üîí ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</button>
    <button id="adminLogoutBtn" class="login-btn" onclick="logout()" style="display: none; background: #ffcdd2; color: #c62828;">üîì ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button>
    
    <h1 id="headerTitle">üìö ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡∏®‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ö‡∏•‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç</h1>
    <p id="headerSubtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
    <div class="connection-status" id="connectionStatus"><span id="statusIcon">üîå</span> <span id="statusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</span></div>
   </header>
   
   <nav class="nav-container">
       <button class="nav-button active" onclick="navigateTo('dashboard')">üè† Dashboard</button> 
       <button class="nav-button admin-only" onclick="navigateTo('borrow')">üìñ ‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button> 
       <button class="nav-button admin-only" onclick="navigateTo('return')">üì• ‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button> 
       <button class="nav-button admin-only" onclick="navigateTo('books')">üìö ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button> 
       <button class="nav-button admin-only" onclick="navigateTo('members')">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button> 
       <button class="nav-button admin-only" onclick="navigateTo('history')">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
   </nav>

   <div id="dashboard" class="content-section active">
    <div class="dashboard-grid">
     <div class="dashboard-card">
      <h3>‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
      <div class="stat-number" id="totalBooks">0</div>
      <div class="stat-label">‡πÄ‡∏•‡πà‡∏°</div>
     </div>
     <div class="dashboard-card">
      <h3>‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°</h3>
      <div class="stat-number" id="availableBooks">0</div>
      <div class="stat-label">‡πÄ‡∏•‡πà‡∏°</div>
     </div>
     <div class="dashboard-card">
      <h3>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°</h3>
      <div class="stat-number" id="borrowedBooks">0</div>
      <div class="stat-label">‡πÄ‡∏•‡πà‡∏°</div>
     </div>
     <div class="dashboard-card admin-only">
      <h3>‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô</h3>
      <div class="stat-number" id="overdueBooks">0</div>
      <div class="stat-label">‡πÄ‡∏•‡πà‡∏°</div>
     </div>
     <div class="dashboard-card admin-only">
      <h3>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
      <div class="stat-number" id="totalMembers">0</div>
      <div class="stat-label">‡∏Ñ‡∏ô</div>
     </div>
     <div class="dashboard-card admin-only">
      <h3>‡∏¢‡∏∑‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
      <div class="stat-number" id="todayBorrows">0</div>
      <div class="stat-label">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</div>
     </div>
    </div>
    
    <div class="card-container">
     <h2>üìö ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î</h2>
     <div class="search-filters">
        <input type="text" class="search-input" id="searchAvailableBooksPublic" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠..." oninput="searchAvailableBooksPublic()"> 
        <select class="search-input" id="filterCategoryPublic" onchange="searchAvailableBooksPublic()"> 
            <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option> 
            <option value="‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢">‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢</option> 
            <option value="‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô">‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô</option> 
            <option value="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option> 
            <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ">‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</option> 
            <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô">‡∏™‡∏≤‡∏£‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</option> 
            <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏≠‡∏≤‡∏ä‡∏µ‡∏û">‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</option> 
            <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option> 
            <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏±‡∏á‡∏Ñ‡∏°">‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏±‡∏á‡∏Ñ‡∏°</option> 
            <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option> 
        </select>
     </div>
     <div id="availableBooksListPublic"></div>
    </div>

    <div class="chart-wrapper admin-only">
     <h2>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h2>
     <canvas id="borrowChart"></canvas>
    </div>
    <div class="chart-wrapper admin-only">
     <h2>üìö ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</h2>
     <canvas id="popularChart"></canvas>
    </div>
    <div class="card-container admin-only">
     <h2>‚ö†Ô∏è ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô</h2>
     <div id="overdueList"></div>
    </div>
   </div>

   <div id="borrow" class="content-section">
    <div class="card-container">
     <h2>üìñ ‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ (‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö)</h2>
     <form id="borrowForm" onsubmit="handleBorrow(event)">
      <div class="form-layout">
       <div class="input-group">
           <label for="borrowMemberId">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™) *</label> 
           <input type="text" id="borrowMemberId" list="memberOptions" required placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...">
           <datalist id="memberOptions"></datalist>
       </div>

       <div class="input-group"><label for="borrowDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏° *</label> <input type="date" id="borrowDate" required></div>
       <div class="input-group"><label for="dueDate">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô (180 ‡∏ß‡∏±‡∏ô) *</label> <input type="date" id="dueDate" required></div>
       
       <div class="input-group" style="grid-column: 1 / -1; border-top: 1px dashed #c8e6c9; padding-top: 20px;">
           <label style="color: #1b5e20; font-size: 1.1em;">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</label>
           <div style="display: flex; gap: 10px; margin-bottom: 10px;">
               <input type="text" id="borrowBookIdInput" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ (‡πÄ‡∏ä‡πà‡∏ô B001) ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°" style="flex:1; border: 2px solid #66bb6a;">
               <button type="button" class="button-secondary" onclick="addToCart()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</button>
           </div>
       </div>

       <div class="input-group" style="grid-column: 1 / -1;">
           <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ß‡πâ (Cart)</label>
           <div class="data-table-wrapper" style="padding: 0; box-shadow: none; border: 1px solid #c8e6c9;">
               <table class="data-table">
                   <thead style="background: #f1f8e9;">
                       <tr>
                           <th>‡∏£‡∏´‡∏±‡∏™</th>
                           <th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</th>
                           <th style="text-align: center;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                       </tr>
                   </thead>
                   <tbody id="borrowCartTableBody">
                       <tr><td colspan="3" style="text-align:center; color: #aaa; padding: 20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</td></tr>
                   </tbody>
               </table>
           </div>
       </div>

       <div class="input-group" style="grid-column: 1 / -1;"><label for="borrowNotes">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label> <textarea id="borrowNotes" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."></textarea></div>
      </div>
      
      <button type="submit" class="button-primary" id="borrowSubmitBtn" style="width: 100%; margin-top: 10px;"> üìñ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î </button>
     </form>
    </div>
    <div class="card-container">
     <h2>üìö ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°</h2>
     <div class="search-filters"><input type="text" class="search-input" id="searchAvailableBooks" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠..." oninput="searchAvailableBooks()"> </div>
     <div id="availableBooksList"></div>
    </div>
   </div>

   <div id="return" class="content-section">
    <div class="card-container">
     <h2>üì• ‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
     <div class="search-filters"><input type="text" class="search-input" id="searchBorrowed" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°, ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å ‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠..." oninput="searchBorrowedBooks()"></div>
     <div id="borrowedBooksList"></div>
    </div>
   </div>

   <div id="books" class="content-section">
    <div class="card-container">
     <h2>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà</h2>
     <form id="bookForm" onsubmit="handleAddBook(event)">
      <div class="form-layout">
       <div class="input-group"><label for="bookId">‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ *</label> <input type="text" id="bookId" required placeholder="B001"></div>
       <div class="input-group"><label for="bookTitle">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ *</label> <input type="text" id="bookTitle" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠"></div>
       <div class="input-group"><label for="bookAuthor">‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á *</label> <input type="text" id="bookAuthor" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á"></div>
       <div class="input-group"><label for="bookCategory">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà *</label> <select id="bookCategory" required> 
        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option> 
        <option value="‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢">‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢</option> 
        <option value="‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô">‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô</option> 
        <option value="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option> 
        <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ">‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</option> 
        <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô">‡∏™‡∏≤‡∏£‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</option> 
        <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏≠‡∏≤‡∏ä‡∏µ‡∏û">‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</option> 
        <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option> 
        <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏±‡∏á‡∏Ñ‡∏°">‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏±‡∏á‡∏Ñ‡∏°</option> 
        <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option> </select>
       </div>
       <div class="input-group"><label for="bookISBN">ISBN</label> <input type="text" id="bookISBN" placeholder="978-xxx-xxx"></div>
       <div class="input-group"><label for="bookQuantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô *</label> <input type="number" id="bookQuantity" required min="1" value="1"></div>
      </div><button type="submit" class="button-primary"> ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ </button>
     </form>
    </div>
    <div class="data-table-wrapper">
     <h2 style="margin-bottom: 20px;">üìö ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
     <div class="search-filters"><input type="text" class="search-input" id="searchBooks" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠..." oninput="searchBooks()"></div>
     <table class="data-table">
      <thead><tr><th>‡∏£‡∏´‡∏±‡∏™</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</th><th>‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á</th><th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th><th>ISBN</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</th><th>‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°</th><th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
      <tbody id="booksTableBody"></tbody>
     </table>
    </div>
   </div>

   <div id="members" class="content-section">
    <div class="card-container">
     <h2>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</h2>
     <form id="memberForm" onsubmit="handleAddMember(event)">
      <div class="form-layout">
       <div class="input-group"><label for="memberId">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å *</label> <input type="text" id="memberId" required placeholder="M001"></div>
       <div class="input-group"><label for="memberName">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• *</label> <input type="text" id="memberName" required placeholder="‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ"></div>
       <div class="input-group"><label for="memberEmail">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label> <input type="email" id="memberEmail" placeholder="example@mail.com"></div>
       <div class="input-group"><label for="memberPhone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ *</label> <input type="tel" id="memberPhone" required placeholder="08x-xxx-xxxx"></div>
       
       <div class="input-group"><label for="memberType">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó/‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô *</label> 
         <select id="memberType" required> 
             <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option> 
             <option value="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option> 
             <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô</option> 
             <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏õ‡∏•‡∏≤‡∏¢">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏õ‡∏•‡∏≤‡∏¢</option> 
             <option value="‡∏Ñ‡∏£‡∏π">‡∏Ñ‡∏£‡∏π</option> 
             <option value="‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£">‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</option> 
             <option value="‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option> 
         </select>
       </div>
      </div><button type="submit" class="button-primary"> ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å </button>
     </form>
    </div>
    <div class="data-table-wrapper">
     <h2 style="margin-bottom: 20px;">üë• ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
     <div class="search-filters">
        <input type="text" class="search-input" id="searchMembers" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å..." oninput="searchMembers()"> 
        <select class="search-input" id="filterMemberType" onchange="searchMembers()"> 
            <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option> 
            <option value="‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option> 
            <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô</option> 
            <option value="‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏õ‡∏•‡∏≤‡∏¢">‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏õ‡∏•‡∏≤‡∏¢</option> 
            <option value="‡∏Ñ‡∏£‡∏π">‡∏Ñ‡∏£‡∏π</option> 
            <option value="‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£">‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</option> 
            <option value="‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
        </select>
     </div>
     <table class="data-table">
      <thead><tr><th>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th><th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th><th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th><th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
      <tbody id="membersTableBody"></tbody>
     </table>
    </div>
   </div>

   <div id="history" class="content-section">
    <div class="data-table-wrapper">
     <h2 style="margin-bottom: 20px;">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô</h2>
     <div class="search-filters"><input type="text" class="search-input" id="searchHistory" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™..." oninput="searchHistory()"> <select class="search-input" id="filterStatus" onchange="searchHistory()"> <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option> <option value="borrowed">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°</option> <option value="returned">‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option> <option value="overdue">‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î</option> </select> <button class="button-secondary" onclick="exportHistory()">üì• Export CSV (‡∏°‡∏µ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°)</button></div>
     <table class="data-table">
      <thead><tr><th>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°</th><th>‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°</th><th>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô</th><th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr></thead>
      <tbody id="historyTableBody"></tbody>
     </table>
    </div>
   </div>
   
   <footer class="bg-white mt-10 border-t">
    <div class="container mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-gray-500 text-xs sm:text-sm lg:text-base">
        <p class="mb-1">¬© 2025 ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡∏®‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ö‡∏•‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç</p>
    </div>
   </footer>
  </div>

  <script>
    // Configuration
    // ‚ö†Ô∏è ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏°‡πÉ‡∏™‡πà URL Script ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyRS1iie8d2Bj-jxh6n2Y7XcZBoVWOoNxtXIvA6p3rjyx_DnhUyUWR3TqmL7GYwD5Ybiw/exec';
    
    // ‚ö†Ô∏è CONFIGURATION: Password & Loan Days
    const ADMIN_PASSWORD = "admin1250240004"; // ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
    const LOAN_DAYS = 180; // ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏¢‡∏∑‡∏° 180 ‡∏ß‡∏±‡∏ô
    
    let books = [];
    let members = [];
    let borrowRecords = [];
    let borrowCart = []; 
    
    let charts = {};
    let isConnected = false;
    let isAdmin = false;

    const defaultConfig = {
      library_name: "üìö ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡∏®‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ö‡∏•‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç",
      admin_name: "‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥",
      contact_info: "@2025 ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡∏®‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ö‡∏•‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç : ‡∏™‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏î‡∏≠‡∏¢‡∏´‡∏•‡πà‡∏≠ ‡πÇ‡∏ó‡∏£. 062-6834332",
    };

    // ---------------- AUTH SYSTEM ----------------
    function showLoginModal() {
        const overlay = document.createElement('div');
        overlay.className = 'modal-overlay';
        overlay.id = 'loginOverlay';
        overlay.innerHTML = `
            <div class="modal-content login-container">
                <div class="modal-header">üîë ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</div>
                <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö</p>
                <form onsubmit="handleLogin(event)">
                    <input type="password" id="adminPassword" class="login-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required>
                    <div class="modal-buttons" style="justify-content: center; margin-top: 20px;">
                        <button type="button" class="button-secondary" onclick="document.getElementById('loginOverlay').remove()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                        <button type="submit" class="button-primary">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
                    </div>
                </form>
            </div>
        `;
        document.body.appendChild(overlay);
        setTimeout(() => document.getElementById('adminPassword').focus(), 100);
    }

    function handleLogin(e) {
        e.preventDefault();
        const pwd = document.getElementById('adminPassword').value;
        if (pwd === ADMIN_PASSWORD) {
            isAdmin = true;
            document.getElementById('mainWrapper').classList.add('show-admin');
            document.getElementById('adminLoginBtn').style.display = 'none';
            document.getElementById('adminLogoutBtn').style.display = 'block';
            document.getElementById('loginOverlay').remove();
            showToast('‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            updateAllViews();
        } else {
            showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
        }
    }

    function logout() {
        isAdmin = false;
        document.getElementById('mainWrapper').classList.remove('show-admin');
        document.getElementById('adminLoginBtn').style.display = 'block';
        document.getElementById('adminLogoutBtn').style.display = 'none';
        navigateTo('dashboard');
        showToast('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß', 'success');
    }

    // ---------------- EXISTING FUNCTIONS ----------------

    function updateConnectionStatus(status) {
      const statusEl = document.getElementById('connectionStatus');
      const iconEl = document.getElementById('statusIcon');
      const textEl = document.getElementById('statusText');
      statusEl.className = 'connection-status';
      if (status === 'connected') {
        statusEl.classList.add('status-connected'); iconEl.textContent = '‚úÖ'; textEl.textContent = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß'; isConnected = true;
      } else if (status === 'syncing') {
        statusEl.classList.add('status-syncing'); iconEl.textContent = 'üîÑ'; textEl.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
      } else {
        statusEl.classList.add('status-disconnected'); iconEl.textContent = '‚ùå'; textEl.textContent = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ'; isConnected = false;
      }
    }
    
    function showLoading() {
      const overlay = document.createElement('div');
      overlay.className = 'loading-overlay';
      overlay.id = 'loadingOverlay';
      overlay.innerHTML = '<div class="loading-spinner"></div>';
      document.body.appendChild(overlay);
    }
    
    function hideLoading() {
      const overlay = document.getElementById('loadingOverlay');
      if (overlay) overlay.remove();
    }
    
    function scriptRequest(params) {
      return new Promise((resolve, reject) => {
        const formData = new FormData();
        Object.keys(params).forEach(key => formData.append(key, params[key]));
        fetch(SCRIPT_URL, { method: 'POST', body: formData })
        .then(response => { if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`); return response.json(); })
        .then(data => { if (data && data.success === false) reject(new Error(data.error || 'Apps Script returned an error.')); else resolve(data); })
        .catch(error => { console.error("Script Request Failed:", error); reject(error); });
      });
    }

    async function loadDataFromSheets() {
      if (isConnected) return;
      showLoading();
      updateConnectionStatus('syncing');
      try {
        const response = await scriptRequest({ action: 'getData' });
        if (response && response.success) {
          books = response.books || [];
          members = response.members || [];
          borrowRecords = response.borrowRecords || [];
          updateConnectionStatus('connected');
          updateAllViews();
          hideLoading();
          showToast('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
          return true;
        } else { throw new Error(response?.error || 'Failed to load data'); }
      } catch (error) {
        console.error('Error loading data:', error);
        updateConnectionStatus('disconnected');
        hideLoading();
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'error');
        return false;
      }
    }

    async function saveToSheets(sheet, data) {
      try {
        updateConnectionStatus('syncing');
        const response = await scriptRequest({ action: 'saveData', sheet: sheet, data: JSON.stringify(data) });
        if (response && response.success) { updateConnectionStatus('connected'); return true; } else { throw new Error(response?.error || 'Failed to save data'); }
      } catch (error) {
        console.error('Error saving data:', error);
        updateConnectionStatus('disconnected');
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'error');
        return false;
      }
    }

    async function deleteFromSheets(sheet, id) {
      try {
        updateConnectionStatus('syncing');
        const response = await scriptRequest({ action: 'deleteData', sheet: sheet, id: id });
        if (response && response.success) { updateConnectionStatus('connected'); return true; } else { throw new Error(response?.error || 'Failed to delete data'); }
      } catch (error) {
        console.error('Error deleting data:', error);
        updateConnectionStatus('disconnected');
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ', 'error');
        return false;
      }
    }

    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => toast.remove(), 3000);
    }
    
    function showConfirmModal(title, message, onConfirm) {
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay';
      overlay.innerHTML = `<div class="modal-content"><div class="modal-header">${title}</div><div class="modal-body">${message}</div><div class="modal-buttons"><button class="button-secondary" onclick="this.closest('.modal-overlay').remove()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button class="button-danger" id="confirmBtn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button></div></div>`;
      document.body.appendChild(overlay);
      document.getElementById('confirmBtn').onclick = () => { onConfirm(); overlay.remove(); };
      overlay.onclick = (e) => { if (e.target === overlay) overlay.remove(); };
    }
    
    function findItem(array, id) { return array.find(item => item.id === id); }

    function showEditModal(title, formHtml, onSave) {
      const existingOverlay = document.getElementById('genericModalOverlay');
      if (existingOverlay) existingOverlay.remove();
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay';
      overlay.id = 'genericModalOverlay';
      overlay.innerHTML = `<div class="modal-content"><div class="modal-header">${title}</div><form id="editForm"><div class="modal-body" style="margin-bottom: 0;">${formHtml}</div><div class="modal-buttons" style="margin-top: 20px;"><button type="button" class="button-secondary" onclick="this.closest('.modal-overlay').remove()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button type="submit" class="button-primary" id="saveEditBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button></div></form></div>`;
      document.body.appendChild(overlay);
      const form = document.getElementById('editForm');
      form.onsubmit = async (e) => {
        e.preventDefault();
        const btn = document.getElementById('saveEditBtn');
        btn.disabled = true; btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
        await onSave(); overlay.remove();
      };
      overlay.onclick = (e) => { if (e.target === overlay) overlay.remove(); };
    }

    function navigateTo(sectionId) {
      document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
      document.getElementById(sectionId).classList.add('active');
      document.querySelectorAll('.nav-button').forEach(button => button.classList.remove('active'));
      const targetButton = event.target.closest('.nav-button');
      if (targetButton) targetButton.classList.add('active');

      if (sectionId === 'books') updateBooksTable();
      if (sectionId === 'members') updateMembersTable();
      if (sectionId === 'history') updateHistoryTable();
      if (sectionId === 'borrow') {
        updateAvailableBooksList();
        const today = new Date().toISOString().split('T')[0];
        const dueDate = new Date();
        dueDate.setDate(dueDate.getDate() + LOAN_DAYS);
        document.getElementById('borrowDate').value = today;
        document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
      }
      if (sectionId === 'return') updateBorrowedBooksList();
      if (sectionId === 'dashboard') updateAvailableBooksListPublic();
    }

    // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (Datalist)
    function updateMemberOptions() {
        const datalist = document.getElementById('memberOptions');
        if(datalist) {
            datalist.innerHTML = members.map(m => `<option value="${m.id} : ${m.name}">`).join('');
        }
    }

    function updateAllViews() {
      updateDashboardStats();
      updateAvailableBooksListPublic();
      updateMemberOptions(); // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏™‡∏°‡∏≠
      
      if (isAdmin) {
          updateCharts();
          updateBooksTable();
          updateMembersTable();
          updateHistoryTable();
          updateAvailableBooksList();
          updateBorrowedBooksList();
      }
    }

    function updateDashboardStats() {
      const totalAvailable = books.reduce((sum, book) => sum + parseInt(book.available), 0);
      const totalBorrowed = borrowRecords.filter(b => b.status === 'borrowed').length;
      const today = new Date().toISOString().split('T')[0];
      const todayBorrows = borrowRecords.filter(b => b.borrowDate === today && b.status === 'borrowed').length;
      const overdue = borrowRecords.filter(b => b.status === 'borrowed' && new Date(b.dueDate) < new Date());

      document.getElementById('totalBooks').textContent = books.length;
      document.getElementById('availableBooks').textContent = totalAvailable;
      document.getElementById('borrowedBooks').textContent = totalBorrowed;
      document.getElementById('overdueBooks').textContent = overdue.length;
      document.getElementById('totalMembers').textContent = members.length;
      document.getElementById('todayBorrows').textContent = todayBorrows;
      
      const overdueList = document.getElementById('overdueList');
      if (overdue.length === 0) {
        overdueList.innerHTML = '<p style="color: #66bb6a; text-align: center; padding: 20px;">üéâ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô</p>';
      } else {
        overdueList.innerHTML = overdue.map(item => {
          const book = books.find(b => b.id === item.bookId);
          const member = members.find(m => m.id === item.memberId);
          const daysOverdue = Math.floor((new Date() - new Date(item.dueDate)) / (1000 * 60 * 60 * 24));
          return `<div class="book-card"><div class="book-card-header"><div><div class="book-card-title">${book ? book.title : item.bookId}</div><div class="book-card-author">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: ${member ? member.name : item.memberId}</div></div><span class="status-badge status-overdue">‡πÄ‡∏Å‡∏¥‡∏ô ${daysOverdue} ‡∏ß‡∏±‡∏ô</span></div><div class="book-card-info"><div class="book-card-info-item"><span class="book-card-info-label">‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠:</span> ${item.bookId}</div><div class="book-card-info-item"><span class="book-card-info-label">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô:</span> ${item.dueDate}</div></div></div>`;
        }).join('');
      }
    }
    
    function updateAvailableBooksListPublic() {
        const searchTerm = document.getElementById('searchAvailableBooksPublic')?.value.toLowerCase() || '';
        const filterCategory = document.getElementById('filterCategoryPublic')?.value || '';
        let availableBooks = books.filter(book => parseInt(book.available) > 0);
        availableBooks = availableBooks.filter(book => {
            const matchSearch = book.id.toLowerCase().includes(searchTerm) || book.title.toLowerCase().includes(searchTerm) || book.author.toLowerCase().includes(searchTerm);
            const matchCategory = !filterCategory || book.category === filterCategory;
            return matchSearch && matchCategory;
        });
        const container = document.getElementById('availableBooksListPublic');
        if (availableBooks.length === 0) {
            container.innerHTML = '<div class="empty-message"><div class="empty-icon">üìñ</div><h3>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</h3></div>'; return;
        }
        container.innerHTML = availableBooks.map(book => `
            <div class="book-card">
            <div class="book-card-header"><div><div class="book-card-title">${book.title}</div><div class="book-card-author">‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á: ${book.author}</div></div><span class="status-badge status-available">‡πÄ‡∏´‡∏•‡∏∑‡∏≠: ${book.available} ‡πÄ‡∏•‡πà‡∏°</span></div>
            <div class="book-card-info"><div class="book-card-info-item"><span class="book-card-info-label">‡∏£‡∏´‡∏±‡∏™:</span> ${book.id}</div><div class="book-card-info-item"><span class="book-card-info-label">‡∏´‡∏°‡∏ß‡∏î:</span> ${book.category}</div><div class="book-card-info-item"><span class="book-card-info-label">ISBN:</span> ${book.isbn || '-'}</div></div></div>
        `).join('');
    }
    function searchAvailableBooksPublic() { updateAvailableBooksListPublic(); }

    async function handleAddBook(event) {
      event.preventDefault();
      const bookId = document.getElementById('bookId').value;
      if (books.some(b => b.id === bookId)) { showToast('‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß', 'warning'); return; }
      const quantity = parseInt(document.getElementById('bookQuantity').value);
      const book = { id: bookId, title: document.getElementById('bookTitle').value, author: document.getElementById('bookAuthor').value, category: document.getElementById('bookCategory').value, isbn: document.getElementById('bookISBN').value || '', quantity: quantity, available: quantity, timestamp: Date.now() };
      const btn = event.target.querySelector('button[type="submit"]'); btn.disabled = true; btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
      const success = await saveToSheets('books', book);
      if (success) { books.push(book); updateAllViews(); showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success'); event.target.reset(); }
      btn.disabled = false; btn.textContent = '‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠';
    }

    async function handleAddMember(event) {
      event.preventDefault();
      const memberId = document.getElementById('memberId').value;
      if (members.some(m => m.id === memberId)) { showToast('‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß', 'warning'); return; }
      const member = { id: memberId, name: document.getElementById('memberName').value, email: document.getElementById('memberEmail').value || '', phone: document.getElementById('memberPhone').value, type: document.getElementById('memberType').value, timestamp: Date.now() };
      const btn = event.target.querySelector('button[type="submit"]'); btn.disabled = true; btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
      const success = await saveToSheets('members', member);
      if (success) { members.push(member); updateAllViews(); showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success'); event.target.reset(); }
      btn.disabled = false; btn.textContent = '‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
    }

    // ---------------------- MULTI-BORROW LOGIC ----------------------

    function addToCart() {
        const input = document.getElementById('borrowBookIdInput');
        const bookId = input.value.trim();
        
        if (!bookId) return;

        const book = books.find(b => b.id === bookId);
        if (!book) {
            showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'warning');
            return;
        }

        const alreadyInCart = borrowCart.filter(item => item.id === bookId).length;
        
        if (parseInt(book.available) - alreadyInCart <= 0) {
            showToast('‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡πà‡∏°‡∏ô‡∏µ‡πâ‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß (‡∏´‡∏£‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≤‡∏Ñ‡∏£‡∏ö‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡πÅ‡∏•‡πâ‡∏ß)', 'warning');
            return;
        }

        borrowCart.push(book);
        input.value = ''; 
        input.focus();
        updateCartTable();
    }

    function removeFromCart(index) {
        borrowCart.splice(index, 1);
        updateCartTable();
    }

    function updateCartTable() {
        const tbody = document.getElementById('borrowCartTableBody');
        const btn = document.getElementById('borrowSubmitBtn');

        if (borrowCart.length === 0) {
            tbody.innerHTML = '<tr><td colspan="3" style="text-align:center; color: #aaa; padding: 20px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</td></tr>';
            btn.textContent = 'üìñ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î';
            return;
        }

        tbody.innerHTML = borrowCart.map((book, index) => `
            <tr>
                <td>${book.id}</td>
                <td>${book.title}</td>
                <td style="text-align: center;">
                    <button type="button" class="button-danger" style="padding: 5px 10px; font-size: 0.8em;" onclick="removeFromCart(${index})">‚ùå ‡∏•‡∏ö</button>
                </td>
            </tr>
        `).join('');
        
        btn.textContent = `üìñ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (${borrowCart.length} ‡πÄ‡∏•‡πà‡∏°)`;
    }

    async function handleBorrow(event) {
      event.preventDefault();
      
      let memberIdInput = document.getElementById('borrowMemberId').value;
      let memberId = memberIdInput;
      
      if (memberIdInput.includes(':')) {
          memberId = memberIdInput.split(':')[0].trim();
      }

      const member = members.find(m => m.id === memberId);
      
      if (!member) { showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á)', 'warning'); return; }
      if (borrowCart.length === 0) { showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡πÄ‡∏•‡πà‡∏°', 'warning'); return; }

      const btn = document.getElementById('borrowSubmitBtn');
      btn.disabled = true;
      
      let successCount = 0;
      let failCount = 0;

      for (let i = 0; i < borrowCart.length; i++) {
          const bookInCart = borrowCart[i];
          btn.textContent = `‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å... (${i + 1}/${borrowCart.length})`;
          
          const liveBook = books.find(b => b.id === bookInCart.id);
          
          if (liveBook && parseInt(liveBook.available) > 0) {
              const borrow = { 
                  id: 'BR' + Date.now() + Math.floor(Math.random() * 1000), 
                  memberId: memberId, 
                  bookId: liveBook.id, 
                  bookTitle: liveBook.title, 
                  borrowDate: document.getElementById('borrowDate').value, 
                  dueDate: document.getElementById('dueDate').value, 
                  returnDate: '', 
                  status: 'borrowed', 
                  notes: document.getElementById('borrowNotes').value || '', 
                  timestamp: Date.now() 
              };
              
              const success = await saveToSheets('borrows', borrow);
              if (success) {
                  liveBook.available = parseInt(liveBook.available) - 1; 
                  await saveToSheets('books', liveBook);
                  borrowRecords.push(borrow); 
                  successCount++;
              } else {
                  failCount++;
              }
          } else {
              failCount++;
          }
      }

      updateAllViews();
      if (failCount === 0) {
          showToast(`‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡∏Ñ‡∏£‡∏ö ${successCount} ‡πÄ‡∏•‡πà‡∏°!`, 'success');
          borrowCart = []; 
          updateCartTable();
          event.target.reset(); 
          
          const today = new Date().toISOString().split('T')[0];
          const dueDate = new Date(); dueDate.setDate(dueDate.getDate() + LOAN_DAYS);
          document.getElementById('borrowDate').value = today; 
          document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
      } else {
          showToast(`‡∏¢‡∏∑‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successCount} ‡πÄ‡∏•‡πà‡∏°, ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ${failCount} ‡πÄ‡∏•‡πà‡∏° (‡∏≠‡∏≤‡∏à‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏´‡∏°‡∏î)`, 'warning');
          borrowCart = []; 
          updateCartTable();
      }

      btn.disabled = false;
    }

    // --------------------------------------------------------------------

    function returnBook(borrowId) {
      const borrow = borrowRecords.find(b => b.id === borrowId);
      if (!borrow) return;
      showConfirmModal('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô', `‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠: ${borrow.bookTitle}?`, async () => {
          borrow.status = 'returned'; borrow.returnDate = new Date().toISOString().split('T')[0];
          const success = await saveToSheets('borrows', borrow);
          if (success) {
              const book = books.find(b => b.id === borrow.bookId);
              if (book) { book.available = parseInt(book.available) + 1; await saveToSheets('books', book); }
              updateAllViews(); showToast('‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
          }
      });
    }

    // ‚úÖ NEW: ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥
    function editHistory(recordId) {
        const record = borrowRecords.find(r => r.id === recordId);
        if (!record) return;

        // ‡∏î‡∏∂‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
        const member = members.find(m => m.id === record.memberId);
        const memberName = member ? member.name : '-';

        const formHtml = `
            <input type="hidden" id="editHistoryId" value="${record.id}">
            <div class="form-layout">
                <div class="input-group"><label>‡∏£‡∏´‡∏±‡∏™‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)</label> <input type="text" value="${record.id}" disabled></div>
                <div class="input-group"><label>‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏° (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)</label> <input type="text" value="${memberName}" disabled></div>
                <div class="input-group"><label>‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)</label> <input type="text" value="${record.bookTitle}" disabled></div>
                
                <div class="input-group"><label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏° (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ) *</label> <input type="date" id="editBorrowDate" value="${record.borrowDate}" required></div>
                <div class="input-group"><label>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ) *</label> <input type="date" id="editDueDate" value="${record.dueDate}" required></div>
                
                <div class="input-group" style="background: #e3f2fd; padding: 10px; border-radius: 8px;">
                    <label style="color: #0d47a1;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô (‡∏•‡∏á‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÅ‡∏•‡πâ‡∏ß)</label> 
                    <input type="date" id="editReturnDate" value="${record.returnDate || ''}">
                    <p style="font-size: 0.8em; color: #666; margin-top: 5px;">* ‡∏´‡∏≤‡∏Å‡πÉ‡∏™‡πà‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô "‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß" ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                </div>
            </div>
        `;
        showEditModal(`‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°`, formHtml, updateHistoryDetails);
    }

    async function updateHistoryDetails() {
        const id = document.getElementById('editHistoryId').value;
        const oldRecord = borrowRecords.find(r => r.id === id);
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
        const updatedRecord = {
            ...oldRecord,
            borrowDate: document.getElementById('editBorrowDate').value,
            dueDate: document.getElementById('editDueDate').value,
            returnDate: document.getElementById('editReturnDate').value
        };

        // Logic ‡∏õ‡∏£‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô
        if (updatedRecord.returnDate) {
            updatedRecord.status = 'returned';
        } else {
            updatedRecord.status = 'borrowed'; // ‡∏ñ‡πâ‡∏≤‡∏•‡∏ö‡∏ß‡∏±‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏≠‡∏Å ‡πÉ‡∏´‡πâ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏¢‡∏∑‡∏°
        }

        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (Optimistic update)
        const index = borrowRecords.findIndex(r => r.id === id);
        if (index !== -1) borrowRecords[index] = updatedRecord;

        showLoading();
        const success = await saveToSheets('borrows', updatedRecord);
        hideLoading();

        if (success) {
            updateAllViews();
            showToast('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            return true;
        } else {
            // ‡∏ñ‡πâ‡∏≤‡∏û‡∏±‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏î‡∏¥‡∏°
            if (index !== -1) borrowRecords[index] = oldRecord;
            updateAllViews();
            return false;
        }
    }

    function editBook(bookId) {
      const book = findItem(books, bookId);
      if (!book) return;
      const categoryOptions = ['‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢', '‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', '‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ', '‡∏™‡∏≤‡∏£‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô', '‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏≠‡∏≤‡∏ä‡∏µ‡∏û', '‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï', '‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏±‡∏á‡∏Ñ‡∏°', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'].map(cat => `<option value="${cat}" ${book.category === cat ? 'selected' : ''}>${cat}</option>`).join('');
      const formHtml = `<input type="hidden" id="editBookId" value="${book.id}"><div class="form-layout"><div class="input-group"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ *</label> <input type="text" id="editBookTitle" value="${book.title}" required></div><div class="input-group"><label>‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á *</label> <input type="text" id="editBookAuthor" value="${book.author}" required></div><div class="input-group"><label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà *</label> <select id="editBookCategory" required><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>${categoryOptions}</select></div><div class="input-group"><label>ISBN</label> <input type="text" id="editBookISBN" value="${book.isbn || ''}"></div><div class="input-group"><label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î *</label> <input type="number" id="editBookQuantity" value="${book.quantity}" required min="1"></div><div class="input-group"><label>‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° (Auto)</label> <input type="number" value="${book.available}" disabled></div></div>`;
      showEditModal(`‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠: ${book.title}`, formHtml, updateBookDetails);
    }

    async function updateBookDetails() {
      const id = document.getElementById('editBookId').value;
      const oldBook = findItem(books, id);
      const newQuantity = parseInt(document.getElementById('editBookQuantity').value);
      if (newQuantity < parseInt(oldBook.quantity) - parseInt(oldBook.available)) { showToast('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°', 'warning'); return false; }
      const newAvailable = parseInt(oldBook.available) + (newQuantity - parseInt(oldBook.quantity));
      const updatedBook = { id: id, title: document.getElementById('editBookTitle').value, author: document.getElementById('editBookAuthor').value, category: document.getElementById('editBookCategory').value, isbn: document.getElementById('editBookISBN').value, quantity: newQuantity, available: newAvailable, timestamp: oldBook.timestamp };
      const index = books.findIndex(b => b.id === id); if (index !== -1) books[index] = updatedBook;
      showLoading();
      const success = await saveToSheets('books', updatedBook);
      hideLoading();
      if (success) { updateAllViews(); showToast('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success'); return true; }
      else { if (index !== -1) books[index] = oldBook; updateAllViews(); return false; }
    }

    function editMember(memberId) {
      const member = findItem(members, memberId);
      if (!member) return;
      const types = [
          { val: '‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤', text: '‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤' },
          { val: '‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô', text: '‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏ï‡πâ‡∏ô' },
          { val: '‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏õ‡∏•‡∏≤‡∏¢', text: '‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏°‡∏±‡∏ò‡∏¢‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏ï‡∏≠‡∏ô‡∏õ‡∏•‡∏≤‡∏¢' },
          { val: '‡∏Ñ‡∏£‡∏π', text: '‡∏Ñ‡∏£‡∏π' },
          { val: '‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£', text: '‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£' },
          { val: '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', text: '‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' }
      ];
      const typeOptions = types.map(t => `<option value="${t.val}" ${member.type === t.val ? 'selected' : ''}>${t.text}</option>`).join('');
      const formHtml = `<input type="hidden" id="editMemberId" value="${member.id}"><div class="form-layout"><div class="input-group"><label>‡∏£‡∏´‡∏±‡∏™ (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)</label> <input type="text" value="${member.id}" disabled></div><div class="input-group"><label>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• *</label> <input type="text" id="editMemberName" value="${member.name}" required></div><div class="input-group"><label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label> <input type="email" id="editMemberEmail" value="${member.email || ''}"></div><div class="input-group"><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ *</label> <input type="tel" id="editMemberPhone" value="${member.phone}" required></div><div class="input-group"><label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó/‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ä‡∏±‡πâ‡∏ô *</label> <select id="editMemberType" required><option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>${typeOptions}</select></div></div>`;
      showEditModal(`‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: ${member.name}`, formHtml, updateMemberDetails);
    }

    async function updateMemberDetails() {
      const id = document.getElementById('editMemberId').value;
      const oldMember = findItem(members, id);
      const updatedMember = { id: id, name: document.getElementById('editMemberName').value, email: document.getElementById('editMemberEmail').value, phone: document.getElementById('editMemberPhone').value, type: document.getElementById('editMemberType').value, timestamp: oldMember.timestamp };
      const index = members.findIndex(m => m.id === id); if (index !== -1) members[index] = updatedMember;
      showLoading();
      const success = await saveToSheets('members', updatedMember);
      hideLoading();
      if (success) { updateAllViews(); showToast('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success'); return true; }
      else { if (index !== -1) members[index] = oldMember; updateAllViews(); return false; }
    }

    function deleteBook(bookId) {
      const book = books.find(b => b.id === bookId); if (!book) return;
      if (borrowRecords.some(b => b.bookId === bookId && b.status === 'borrowed')) { showToast('‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà ‡∏•‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', 'error'); return; }
      showConfirmModal('‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö: ${book.title}?`, async () => {
          const success = await deleteFromSheets('books', bookId);
          if (success) { books = books.filter(b => b.id !== bookId); updateAllViews(); showToast('‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success'); }
      });
    }

    function deleteMember(memberId) {
      const member = members.find(m => m.id === memberId); if (!member) return;
      if (borrowRecords.some(b => b.memberId === memberId && b.status === 'borrowed')) { showToast('‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏¢‡∏π‡πà ‡∏•‡∏ö‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ', 'error'); return; }
      showConfirmModal('‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å', `‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö: ${member.name}?`, async () => {
          const success = await deleteFromSheets('members', memberId);
          if (success) { members = members.filter(m => m.id !== memberId); updateAllViews(); showToast('‡∏•‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success'); }
      });
    }

    function updateBooksTable() {
      const searchTerm = document.getElementById('searchBooks')?.value.toLowerCase() || '';
      const filteredBooks = books.filter(book => book.id.toLowerCase().includes(searchTerm) || book.title.toLowerCase().includes(searchTerm) || book.author.toLowerCase().includes(searchTerm) || book.category.toLowerCase().includes(searchTerm));
      const tbody = document.getElementById('booksTableBody');
      if (filteredBooks.length === 0) { tbody.innerHTML = `<tr><td colspan="8" class="empty-message"><div class="empty-icon">üìö</div><h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h3></td></tr>`; return; }
      tbody.innerHTML = filteredBooks.map(book => `<tr><td>${book.id}</td><td>${book.title}</td><td>${book.author}</td><td>${book.category}</td><td>${book.isbn || '-'}</td><td>${book.quantity}</td><td>${book.available}</td><td><div class="action-button-group"><button class="button-secondary" onclick="editBook('${book.id}')">‚úèÔ∏è</button><button class="button-danger" onclick="deleteBook('${book.id}')">üóëÔ∏è</button></div></td></tr>`).join('');
    }

    function updateMembersTable() {
      const searchTerm = document.getElementById('searchMembers')?.value.toLowerCase() || '';
      const filterType = document.getElementById('filterMemberType')?.value || '';
      const filteredMembers = members.filter(member => {
        const matchSearch = member.id.toLowerCase().includes(searchTerm) || member.name.toLowerCase().includes(searchTerm);
        const matchType = !filterType || member.type === filterType;
        return matchSearch && matchType;
      });
      const tbody = document.getElementById('membersTableBody');
      if (filteredMembers.length === 0) { tbody.innerHTML = `<tr><td colspan="6" class="empty-message"><div class="empty-icon">üë•</div><h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h3></td></tr>`; return; }
      tbody.innerHTML = filteredMembers.map(member => `<tr><td>${member.id}</td><td>${member.name}</td><td>${member.email || '-'}</td><td>${member.phone}</td><td>${member.type}</td><td><div class="action-button-group"><button class="button-secondary" onclick="editMember('${member.id}')">‚úèÔ∏è</button><button class="button-danger" onclick="deleteMember('${member.id}')">üóëÔ∏è</button></div></td></tr>`).join('');
    }

    function updateHistoryTable() {
      const searchTerm = document.getElementById('searchHistory')?.value.toLowerCase() || '';
      const filterStatus = document.getElementById('filterStatus')?.value || '';
      let filteredHistory = borrowRecords.filter(record => {
        // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
        const member = members.find(m => m.id === record.memberId);
        const memberName = member ? member.name.toLowerCase() : '';

        const matchSearch = record.memberId.toLowerCase().includes(searchTerm) || 
                            record.bookId.toLowerCase().includes(searchTerm) || 
                            record.bookTitle.toLowerCase().includes(searchTerm) ||
                            memberName.includes(searchTerm); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠
        
        let matchStatus = true;
        if (filterStatus === 'borrowed') matchStatus = record.status === 'borrowed' && new Date(record.dueDate) >= new Date();
        else if (filterStatus === 'returned') matchStatus = record.status === 'returned';
        else if (filterStatus === 'overdue') matchStatus = record.status === 'borrowed' && new Date(record.dueDate) < new Date();
        return matchSearch && matchStatus;
      });
      filteredHistory.sort((a, b) => b.timestamp - a.timestamp);
      const tbody = document.getElementById('historyTableBody');
      if (filteredHistory.length === 0) { tbody.innerHTML = `<tr><td colspan="8" class="empty-message"><div class="empty-icon">üìã</div><h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</h3></td></tr>`; return; }
      tbody.innerHTML = filteredHistory.map(record => {
        let statusBadge = '', statusClass = '';
        if (record.status === 'returned') { statusBadge = '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß'; statusClass = 'status-returned'; }
        else if (new Date(record.dueDate) < new Date()) { statusBadge = '‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î'; statusClass = 'status-overdue'; }
        else { statusBadge = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°'; statusClass = 'status-borrowed'; }
        
        // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        const member = members.find(m => m.id === record.memberId);
        const memberName = member ? member.name : '-';

        // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏ô Action Group
        return `
          <tr>
            <td>${record.memberId}</td>
            <td>${memberName}</td>
            <td>${record.bookId}</td>
            <td>${record.bookTitle}</td>
            <td>${record.borrowDate}</td>
            <td>${record.dueDate}</td>
            <td>${record.returnDate || '-'}</td>
            <td><span class="status-badge ${statusClass}">${statusBadge}</span></td>
            <td>
              <div class="action-button-group">
                <button class="button-secondary" onclick="editHistory('${record.id}')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                ${record.status === 'borrowed' ? `<button class="button-success" onclick="returnBook('${record.id}')">üì• ‡∏Ñ‡∏∑‡∏ô</button>` : ''}
              </div>
            </td>
          </tr>`;
      }).join('');
    }

    function updateAvailableBooksList() {
      const searchTerm = document.getElementById('searchAvailableBooks')?.value.toLowerCase() || '';
      let availableBooks = books.filter(book => parseInt(book.available) > 0 && (book.id.toLowerCase().includes(searchTerm) || book.title.toLowerCase().includes(searchTerm) || book.author.toLowerCase().includes(searchTerm)));
      const container = document.getElementById('availableBooksList');
      if (availableBooks.length === 0) { container.innerHTML = '<div class="empty-message"><h3>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h3></div>'; return; }
      container.innerHTML = availableBooks.map(book => `<div class="book-card"><div class="book-card-header"><div><div class="book-card-title">${book.title}</div><div class="book-card-author">${book.author}</div></div><span class="status-badge status-available">${book.available} ‡πÄ‡∏•‡πà‡∏°</span></div><div class="book-card-info"><div class="book-card-info-item"><span class="book-card-info-label">‡∏£‡∏´‡∏±‡∏™:</span> ${book.id}</div></div></div>`).join('');
    }

    // ‚úÖ ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ
    function updateBorrowedBooksList() {
      const searchTerm = document.getElementById('searchBorrowed')?.value.toLowerCase() || '';
      let borrows = borrowRecords.filter(b => b.status === 'borrowed');
      
      borrows = borrows.filter(borrow => {
        // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡∏°‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö
        const member = members.find(m => m.id === borrow.memberId);
        const memberName = member ? member.name.toLowerCase() : '';
        
        return (
          borrow.memberId.toLowerCase().includes(searchTerm) || 
          borrow.bookId.toLowerCase().includes(searchTerm) || 
          borrow.bookTitle.toLowerCase().includes(searchTerm) ||
          memberName.includes(searchTerm) // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠
        );
      });

      borrows.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
      const container = document.getElementById('borrowedBooksList');
      if (borrows.length === 0) { container.innerHTML = '<div class="empty-message"><h3>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</h3></div>'; return; }
      
      container.innerHTML = borrows.map(borrow => {
        const member = members.find(m => m.id === borrow.memberId);
        const isOverdue = new Date(borrow.dueDate) < new Date();
        return `<div class="book-card"><div class="book-card-header"><div><div class="book-card-title">${borrow.bookTitle}</div><div class="book-card-author">‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°: ${member ? member.name : borrow.memberId}</div></div><span class="status-badge ${isOverdue ? 'status-overdue' : 'status-borrowed'}">${isOverdue ? '‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°'}</span></div><div class="book-card-info"><div class="book-card-info-item"><span class="book-card-info-label">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô:</span> ${borrow.dueDate}</div></div><div style="margin-top: 15px;"><button class="button-success" onclick="returnBook('${borrow.id}')">üì• ‡∏Ñ‡∏∑‡∏ô</button></div></div>`;
      }).join('');
    }

    function searchBooks() { updateBooksTable(); }
    function searchMembers() { updateMembersTable(); }
    function searchHistory() { updateHistoryTable(); }
    function searchAvailableBooks() { updateAvailableBooksList(); }
    function searchBorrowedBooks() { updateBorrowedBooksList(); }

    function exportHistory() {
      if (borrowRecords.length === 0) { showToast('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'warning'); return; }
      // ‚úÖ ‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°"
      const headers = ['‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å', '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°', '‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°', '‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'];
      const csvContent = borrowRecords.map(record => {
        let status = record.status === 'returned' ? '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß' : (new Date(record.dueDate) < new Date() ? '‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î' : '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°');
        
        // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å
        const member = members.find(m => m.id === record.memberId);
        const memberName = member ? member.name : '-';

        return [
          record.memberId,
          `"${memberName}"`, // ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏¢‡∏∑‡∏°
          record.bookId, 
          `"${record.bookTitle.replace(/"/g, '""')}"`, 
          record.borrowDate, 
          record.dueDate, 
          record.returnDate || '', 
          status
        ].join(',');
      }).join('\n');
      
      const blob = new Blob(["\ufeff", headers.join(',') + '\n' + csvContent], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob); link.download = `library_history_${new Date().toISOString().split('T')[0]}.csv`;
      document.body.appendChild(link); link.click(); document.body.removeChild(link);
    }
    
    function initializeCharts() {
      const options = { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { precision: 0 } } }, plugins: { legend: { display: false } } };
      if (charts.borrow) charts.borrow.destroy();
      charts.borrow = new Chart(document.getElementById('borrowChart').getContext('2d'), { type: 'line', data: { labels: [], datasets: [{ label: '‡∏¢‡∏∑‡∏°', data: [], backgroundColor: 'rgba(102, 187, 106, 0.5)', borderColor: '#66bb6a', borderWidth: 2, tension: 0.4 }] }, options });
      if (charts.popular) charts.popular.destroy();
      charts.popular = new Chart(document.getElementById('popularChart').getContext('2d'), { type: 'bar', data: { labels: [], datasets: [{ label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô', data: [], backgroundColor: '#ffb74d' }] }, options: { ...options, indexAxis: 'y' } });
    }

    function updateCharts() {
      if (!charts.borrow || !charts.popular) return;
      const last7Days = [], borrowCounts = [];
      for (let i = 6; i >= 0; i--) {
        const d = new Date(); d.setDate(d.getDate() - i);
        last7Days.push(`${d.getDate()}/${d.getMonth() + 1}`);
        borrowCounts.push(borrowRecords.filter(b => b.borrowDate === d.toISOString().split('T')[0]).length);
      }
      charts.borrow.data.labels = last7Days; charts.borrow.data.datasets[0].data = borrowCounts; charts.borrow.update();
      
      const bookCounts = {}; borrowRecords.forEach(b => bookCounts[b.bookTitle] = (bookCounts[b.bookTitle] || 0) + 1);
      const top = Object.entries(bookCounts).sort((a, b) => b[1] - a[1]).slice(0, 10);
      charts.popular.data.labels = top.map(b => b[0]); charts.popular.data.datasets[0].data = top.map(b => b[1]); charts.popular.update();
    }

    function onConfigChange(config) {
      document.getElementById('headerTitle').textContent = config.library_name || defaultConfig.library_name;
      document.getElementById('headerSubtitle').textContent = config.admin_name || defaultConfig.admin_name;
      document.querySelector('footer p.mb-1').textContent = config.contact_info || defaultConfig.contact_info;
    }
    
    function initializeApp() {
      if (typeof elementSDK !== 'undefined') elementSDK.config.onConfigChange(onConfigChange); else onConfigChange(defaultConfig);
      initializeCharts();
      loadDataFromSheets();
      updateAvailableBooksListPublic();
    }

    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initializeApp); else initializeApp();
  </script>
 </body>
</html>
