<!doctype html>
<html lang="th">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡∏®‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ö‡∏•‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç : ‡∏™‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏î‡∏≠‡∏¢‡∏´‡∏•‡πà‡∏≠</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      height: 100%;
      width: 100%;
    }
    
    body {
      font-family: 'Sarabun', sans-serif;
      background: linear-gradient(135deg, #e8f5e9 0%, #fff3e0 100%);
    }
    
    /* ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö Layout ‡∏´‡∏•‡∏±‡∏Å */
.main-wrapper {
  /* ‡πÄ‡∏î‡∏¥‡∏°: width: 100%; */
  width: 100%; 
  max-width: 1200px; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏≠‡∏Ç‡∏ô‡∏≤‡∏î‡πÉ‡∏´‡∏ç‡πà */
  margin: 0 auto; /* ‡∏à‡∏±‡∏î‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏Å‡∏∂‡πà‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ */
  padding: 15px; /* ‡∏•‡∏î Padding ‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
}

/* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡πà‡∏ß‡∏ô‡∏¢‡πà‡∏≠‡∏¢‡∏ï‡πà‡∏≤‡∏á‡πÜ ‡πÉ‡∏ä‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏ï‡πá‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á */
.dashboard, .data-tables, .form-container, .tab-content {
    width: 100%;
}
    
    .app-header {
      background: linear-gradient(135deg, #66bb6a 0%, #ffb74d 100%);
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      text-align: center;
      margin-bottom: 30px;
    }
    
    .app-header h1 {
      color: #1b5e20;
      font-size: 2.5em;
      font-weight: 700;
      margin-bottom: 10px;
    }
    
    .app-header p {
      color: #2e7d32;
      font-size: 1.1em;
    }
    
    .connection-status {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: 600;
      margin-top: 10px;
    }
    
    .status-connected {
      background: #c8e6c9;
      color: #2e7d32;
    }
    
    .status-disconnected {
      background: #ffcdd2;
      color: #c62828;
    }
    
    .status-syncing {
      background: #fff9c4;
      color: #f57f17;
    }
    
    .nav-container {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }
    
    .nav-button {
      flex: 1;
      min-width: 140px;
      padding: 15px 20px;
      background: white;
      border: none;
      border-radius: 15px;
      font-size: 1em;
      font-weight: 600;
      color: #2e7d32;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      font-family: 'Sarabun', sans-serif;
    }
    
    .nav-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
    }
    
    .nav-button.active {
      background: linear-gradient(135deg, #81c784 0%, #ffcc80 100%);
      color: #1b5e20;
    }
    
    .content-section {
      display: none;
    }
    
    .content-section.active {
      display: block;
    }
    
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .dashboard-card {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s;
    }
    
    .dashboard-card:hover {
      transform: translateY(-5px);
    }
    
    .dashboard-card h3 {
      color: #2e7d32;
      font-size: 1em;
      margin-bottom: 10px;
      font-weight: 500;
    }
    
    .dashboard-card .stat-number {
      color: #1b5e20;
      font-size: 2.5em;
      font-weight: 700;
    }
    
    .dashboard-card .stat-label {
      color: #66bb6a;
      font-size: 0.9em;
      margin-top: 5px;
    }
    
    .card-container {
      background: white;
      padding: 30px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      margin-bottom: 30px;
    }
    
    .card-container h2 {
      color: #1b5e20;
      margin-bottom: 20px;
      font-size: 1.5em;
    }
    /* ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô <style> ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà */
.form-layout {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); /* ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡∏à‡∏∞‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô 2 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏°‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏≠ (250px) */
  gap: 20px;
  margin-bottom: 20px;
}
    
    .input-group {
      display: flex;
      flex-direction: column;
    }
    
    .input-group label {
      color: #2e7d32;
      font-weight: 600;
      margin-bottom: 8px;
      font-size: 1em;
    }
    
    .input-group input,
    .input-group select,
    .input-group textarea {
      padding: 12px 15px;
      border: 2px solid #c8e6c9;
      border-radius: 10px;
      font-size: 1em;
      font-family: 'Sarabun', sans-serif;
      transition: border-color 0.3s;
      background: #fafafa;
    }
    
    .input-group input:focus,
    .input-group select:focus,
    .input-group textarea:focus {
      outline: none;
      border-color: #66bb6a;
      background: white;
    }
    
    .input-group textarea {
      resize: vertical;
      min-height: 80px;
    }
    
    .button-primary {
      padding: 15px 30px;
      border: none;
      border-radius: 10px;
      font-size: 1.1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Sarabun', sans-serif;
      background: linear-gradient(135deg, #66bb6a 0%, #ffb74d 100%);
      color: #1b5e20;
      box-shadow: 0 4px 15px rgba(102, 187, 106, 0.3);
    }
    
    .button-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 187, 106, 0.4);
    }
    
    .button-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    
    .button-secondary {
      background: #e8f5e9;
      color: #2e7d32;
      padding: 12px 25px;
      border: none;
      border-radius: 10px;
      font-size: 1em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Sarabun', sans-serif;
    }
    
    .button-secondary:hover {
      background: #c8e6c9;
    }
    
    .button-danger {
      background: #ffcdd2;
      color: #c62828;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Sarabun', sans-serif;
    }
    
    .button-danger:hover {
      background: #ef9a9a;
    }
    
    .button-success {
      background: #c8e6c9;
      color: #2e7d32;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      font-size: 0.9em;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      font-family: 'Sarabun', sans-serif;
    }
    
    .button-success:hover {
      background: #a5d6a7;
    }
    
    .search-filters {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    
    .search-input {
      flex: 1;
      min-width: 200px;
      padding: 12px 15px;
      border: 2px solid #c8e6c9;
      border-radius: 10px;
      font-size: 1em;
      font-family: 'Sarabun', sans-serif;
    }
    
    .data-table-wrapper {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      overflow-x: auto;
    }
    
    /* ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏•‡πâ‡∏ô‡∏à‡∏≠ */
.data-tables {
  overflow-x: auto; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡πÉ‡∏ô Data Tables ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÉ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÑ‡∏î‡πâ */
  padding-bottom: 10px; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡∏™‡∏∞‡∏î‡∏ß‡∏Å */
}

table {
  width: 100%;
  border-collapse: collapse;
  min-width: 600px; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏Ç‡∏≠‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡πÄ‡∏ö‡∏µ‡∏¢‡∏î‡∏Å‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠ */
}

table th, table td {
  padding: 8px; /* ‡∏•‡∏î Padding ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ã‡∏•‡∏•‡πå‡πÄ‡∏•‡πá‡∏Å‡∏ô‡πâ‡∏≠‡∏¢ */
  font-size: 0.9em; /* ‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
  text-align: left;
  white-space: nowrap; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡πÄ‡∏ã‡∏•‡∏•‡πå‡πÑ‡∏°‡πà‡∏ï‡∏±‡∏î‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î */
}
    
    .data-table tr:hover {
      background: #f1f8e9;
    }
    
    .action-button-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    
    .status-badge {
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.85em;
      font-weight: 600;
      display: inline-block;
    }
    
    .status-available {
      background: #c8e6c9;
      color: #2e7d32;
    }
    
    .status-borrowed {
      background: #fff9c4;
      color: #f57f17;
    }
    
    .status-overdue {
      background: #ffcdd2;
      color: #c62828;
    }
    
    .status-returned {
      background: #b3e5fc;
      color: #01579b;
    }
    
    .empty-message {
      text-align: center;
      padding: 60px 20px;
      color: #66bb6a;
    }
    
    .empty-icon {
      font-size: 4em;
      margin-bottom: 20px;
    }
    
    .empty-message h3 {
      font-size: 1.5em;
      margin-bottom: 10px;
    }
    
    .chart-wrapper {
      background: white;
      padding: 25px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      margin-bottom: 30px;
      /* FIX: Added fixed height and relative position for chart stability */
      height: 400px;
      position: relative;
    }

    /* FIX: Added rule to ensure canvas fits the fixed height wrapper */
    .chart-wrapper canvas {
      height: 100% !important;
      width: 100% !important;
    }
    
    .chart-wrapper h2 {
      color: #1b5e20;
      margin-bottom: 20px;
      font-size: 1.5em;
    }
    
    .book-card {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      margin-bottom: 15px;
      transition: transform 0.3s;
    }
    
    .book-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.12);
    }
    
    .book-card-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 15px;
    }
    
    .book-card-title {
      color: #1b5e20;
      font-size: 1.3em;
      font-weight: 600;
      margin-bottom: 5px;
    }
    
    .book-card-author {
      color: #66bb6a;
      font-size: 1em;
    }
    
    .book-card-info {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 10px;
      margin-bottom: 15px;
    }
    
    .book-card-info-item {
      font-size: 0.9em;
      color: #2e7d32;
    }
    
    .book-card-info-label {
      font-weight: 600;
    }
    
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 10px;
      color: white;
      font-weight: 600;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      z-index: 9999;
      animation: slideIn 0.3s ease-out;
    }
    
    .toast-success {
      background: #66bb6a;
    }
    
    .toast-error {
      background: #ef5350;
    }
    
    .toast-warning {
      background: #ffa726;
    }
    
    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }
    
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9998;
      padding: 20px;
    }
    
    /* ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ô‡∏µ‡πâ‡πÉ‡∏ô <style> */
.modal-content {
  background: white;
  padding: 30px;
  border-radius: 15px;
  max-width: 600px; /* <<< ‡∏õ‡∏£‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô 600px ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏ö‡∏ô‡∏à‡∏≠‡πÉ‡∏´‡∏ç‡πà */
  width: 90%;      /* <<< ‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ 90% ‡∏Ç‡∏≠‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠ ‡πÅ‡∏ï‡πà‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô 600px */
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}
    
    .modal-header {
      color: #1b5e20;
      font-size: 1.5em;
      font-weight: 700;
      margin-bottom: 15px;
    }
    
    .modal-body {
      color: #2e7d32;
      margin-bottom: 20px;
      line-height: 1.6;
    }
    
    .modal-buttons {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 255, 255, 0.9);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10000;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 5px solid #e8f5e9;
      border-top-color: #66bb6a;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @media (max-width: 768px) {
  /* ... ‡πÇ‡∏Ñ‡πâ‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÜ ... */
  .form-layout {
    grid-template-columns: 1fr; /* ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 1 ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
  }
      
      .nav-container {
        flex-direction: column;
      }
      
      .nav-button {
        width: 100%;
      }
      
      .form-layout {
        grid-template-columns: 1fr;
      }
      
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .search-filters {
        flex-direction: column;
      }
      
      .search-input {
        width: 100%;
      }
      
      .data-table-wrapper {
        padding: 15px;
      }
      
      .data-table {
        font-size: 0.9em;
      }
      
      .data-table th,
      .data-table td {
        padding: 10px;
      }
      
      .action-button-group {
        flex-direction: column;
      }
    }
   /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏Ñ‡πâ‡∏î‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏™‡πà‡∏ß‡∏ô <style> */
/* ‡∏•‡∏î Padding ‡∏Ç‡∏≠‡∏á‡∏ä‡πà‡∏≠‡∏á Input ‡πÉ‡∏ô Modal ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏Ñ‡∏ö‡∏•‡∏á‡πÉ‡∏ô‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á */
.modal-content .input-group input,
.modal-content .input-group select,
.modal-content .input-group textarea {
    padding: 10px 15px; /* ‡∏•‡∏î Padding ‡πÅ‡∏ô‡∏ß‡∏ï‡∏±‡πâ‡∏á‡∏à‡∏≤‡∏Å 12px ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 10px */
}
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="main-wrapper">
   <header class="app-header">
    <h1 id="headerTitle">üìö ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡∏®‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ö‡∏•‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç : ‡∏™‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏î‡∏≠‡∏¢‡∏´‡∏•‡πà‡∏≠</h1>
    <p id="headerSubtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
    <div class="connection-status" id="connectionStatus"><span id="statusIcon">üîå</span> <span id="statusText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</span>
    </div>
   </header>
   <nav class="nav-container"><button class="nav-button active" onclick="navigateTo('dashboard')">üè† Dashboard</button> <button class="nav-button" onclick="navigateTo('borrow')">üìñ ‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button> <button class="nav-button" onclick="navigateTo('return')">üì• ‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button> <button class="nav-button" onclick="navigateTo('books')">üìö ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button> <button class="nav-button" onclick="navigateTo('members')">üë• ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</button> <button class="nav-button" onclick="navigateTo('history')">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</button>
   </nav><div id="dashboard" class="content-section active">
    <div class="dashboard-grid">
     <div class="dashboard-card">
  
     <h3>‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
      <div class="stat-number" id="totalBooks">
       0
      </div>
      <div class="stat-label">
       ‡πÄ‡∏•‡πà‡∏°
      </div>
     </div>
     <div class="dashboard-card">
      <h3>‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°</h3>
      <div class="stat-number" id="availableBooks">
       0
      </div>
      <div class="stat-label">
       ‡πÄ‡∏•‡πà‡∏°
   
    </div>
     </div>
     <div class="dashboard-card">
      <h3>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°</h3>
      <div class="stat-number" id="borrowedBooks">
       0
      </div>
      <div class="stat-label">
       ‡πÄ‡∏•‡πà‡∏°
      </div>
     </div>
     <div class="dashboard-card">
      <h3>‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô</h3>
      <div class="stat-number" id="overdueBooks">
       0
      </div>
 
      <div class="stat-label">
       ‡πÄ‡∏•‡πà‡∏°
      </div>
     </div>
     <div class="dashboard-card">
      <h3>‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
      <div class="stat-number" id="totalMembers">
       0
      </div>
      <div class="stat-label">
       ‡∏Ñ‡∏ô
      </div>
     </div>
     <div class="dashboard-card">
      <h3>‡∏¢‡∏∑‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
      
 <div class="stat-number" id="todayBorrows">
       0
      </div>
      <div class="stat-label">
       ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
      </div>
     </div>
    </div>
    <div class="chart-wrapper">
     <h2>üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô (7 ‡∏ß‡∏±‡∏ô‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</h2>
     <canvas id="borrowChart"></canvas>
    </div>
    <div class="chart-wrapper">
     <h2>üìö ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏¢‡∏≠‡∏î‡∏ô‡∏¥‡∏¢‡∏°</h2>
     <canvas id="popularChart"></canvas>
    </div>
    <div class="card-container">
     <h2>‚ö†Ô∏è ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô</h2>
 
     <div id="overdueList"></div>
    </div>
   </div><div id="borrow" class="content-section">
    <div class="card-container">
     <h2>üìñ ‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
     <form id="borrowForm" onsubmit="handleBorrow(event)">
      <div class="form-layout">
       <div class="input-group"><label for="borrowMemberId">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å *</label> <input type="text" id="borrowMemberId" required placeholder="M001">
       </div>
       <div class="input-group"><label for="borrowBookId">‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ *</label> <input type="text" id="borrowBookId" required placeholder="B001">
       </div>
       <div class="input-group"><label for="borrowDate">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏° *</label> 
 <input type="date" id="borrowDate" required>
       </div>
       <div class="input-group"><label for="dueDate">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô *</label> <input type="date" id="dueDate" required>
       </div>
       <div class="input-group" style="grid-column: 1 / -1;"><label for="borrowNotes">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label> <textarea id="borrowNotes" placeholder="‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°..."></textarea>
       </div>
      </div><button type="submit" class="button-primary" id="borrowSubmitBtn"> üìñ ‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ </button>
     </form>
    </div>
    <div class="card-container">
     <h2>üìö ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°</h2>
     <div class="search-filters"><input type="text" class="search-input" id="searchAvailableBooks" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠..." oninput="searchAvailableBooks()"> <select 
 class="search-input" id="filterCategory" onchange="searchAvailableBooks()"> <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option> 
     <option value="‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢">‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢</option> 
     <option value="‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô">‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô</option> 
     <option value="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option> 
     <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ">‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</option> 
     <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô">‡∏™‡∏≤‡∏£‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</option> 
     <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏≠‡∏≤‡∏ä‡∏µ‡∏û">‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</option> 
     <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option> 
     <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏±‡∏á‡∏Ñ‡∏°">‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏±‡∏á‡∏Ñ‡∏°</option> 
     <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option> </select>
     </div>
     <div id="availableBooksList"></div>
    </div>
   </div><div id="return" class="content-section">
    <div class="card-container">
    
  <h2>üì• ‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</h2>
     <div class="search-filters"><input type="text" class="search-input" id="searchBorrowed" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠..." oninput="searchBorrowedBooks()">
     </div>
     <div id="borrowedBooksList"></div>
    </div>
   </div><div id="books" class="content-section">
    <div class="card-container">
     <h2>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏´‡∏°‡πà</h2>
     <form id="bookForm" onsubmit="handleAddBook(event)">
      <div class="form-layout">
       <div class="input-group"><label for="bookId">‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ *</label> <input type="text" id="bookId" required placeholder="B001">
       </div>
       <div class="input-group"><label for="bookTitle">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ *</label> <input 
 type="text" id="bookTitle" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠">
       </div>
       <div class="input-group"><label for="bookAuthor">‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á *</label> <input type="text" id="bookAuthor" required placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á">
       </div>
       <div class="input-group"><label for="bookCategory">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà *</label> <select id="bookCategory" required> 
      <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option> 
        <option value="‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢">‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢</option> 
     <option value="‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô">‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô</option> 
     <option value="‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option> 
     <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ">‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</option> 
     <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô">‡∏™‡∏≤‡∏£‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</option> 
     <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏≠‡∏≤‡∏ä‡∏µ‡∏û">‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</option> 
   <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï">‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï</option>
     <option value="‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏±‡∏á‡∏Ñ‡∏°">‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏±‡∏á‡∏Ñ‡∏°</option> 
     <option value="‡∏≠‡∏∑‡πà‡∏ô‡πÜ">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option> </select>
       </div>
       <div class="input-group"><label for="bookISBN">ISBN</label> <input type="text" id="bookISBN" placeholder="978-xxx-xxx">
       </div>
       <div class="input-group"><label for="bookQuantity">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô *</label> <input type="number" id="bookQuantity" required min="1" value="1">
       </div>
      </div><button type="submit" class="button-primary"> ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ </button>
     </form>
    </div>
    <div class="data-table-wrapper">
     <h2 style="margin-bottom: 20px;">üìö 
 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
     <div class="search-filters"><input type="text" class="search-input" id="searchBooks" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠..." oninput="searchBooks()">
     </div>
     <table class="data-table">
      <thead>
       <tr>
        <th>‡∏£‡∏´‡∏±‡∏™</th>
        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</th>
        <th>‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á</th>
        <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
        <th>ISBN</th>
        <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</th>
        <th>‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°</th>
        
 <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
       </tr>
      </thead>
      <tbody id="booksTableBody"></tbody>
     </table>
    </div>
   </div><div id="members" class="content-section">
    <div class="card-container">
     <h2>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏´‡∏°‡πà</h2>
     <form id="memberForm" onsubmit="handleAddMember(event)">
      <div class="form-layout">
       <div class="input-group"><label for="memberId">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å *</label> <input type="text" id="memberId" required placeholder="M001">
       </div>
       <div class="input-group"><label for="memberName">‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• *</label> <input 
 type="text" id="memberName" required placeholder="‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ">
       </div>
       <div class="input-group"><label for="memberEmail">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label> <input type="email" id="memberEmail" placeholder="example@mail.com">
       </div>
       <div class="input-group"><label for="memberPhone">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ *</label> <input type="tel" id="memberPhone" required placeholder="08x-xxx-xxxx">
       </div>
       <div class="input-group"><label for="memberType">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó *</label> <select id="memberType" required> <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option> <option value="‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option> <option value="‡∏Ñ‡∏£‡∏π">‡∏Ñ‡∏£‡∏π</option> <option value="‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£">‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</option> <option value="‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option> </select>
       </div>
      </div><button type="submit" class="button-primary"> ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å </button>
     
 </form>
    </div>
    <div class="data-table-wrapper">
     <h2 style="margin-bottom: 20px;">üë• ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
     <div class="search-filters"><input type="text" class="search-input" id="searchMembers" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å..." oninput="searchMembers()"> <select class="search-input" id="filterMemberType" onchange="searchMembers()"> <option value="">‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option> <option value="‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤">‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</option> <option value="‡∏Ñ‡∏£‡∏π">‡∏Ñ‡∏£‡∏π</option> <option value="‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£">‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</option> <option value="‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ">‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option> </select>
     </div>
     <table class="data-table">
      <thead>
       <tr>
        <th>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th>
        <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•</th>
        <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</th>
        
 <th>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</th>
        <th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th>
        <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
       </tr>
      </thead>
      <tbody id="membersTableBody"></tbody>
     </table>
    </div>
   </div><div id="history" class="content-section">
    <div class="data-table-wrapper">
     <h2 style="margin-bottom: 20px;">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô</h2>
     <div class="search-filters"><input type="text" class="search-input" id="searchHistory" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." oninput="searchHistory()"> <select class="search-input" id="filterStatus" onchange="searchHistory()"> <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option> <option value="borrowed">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°</option> <option value="returned">‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option> <option value="overdue">‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î</option> </select> <button class="button-secondary" onclick="exportHistory()">üì• Export CSV</button>
 
     </div>
     <table class="data-table">
      <thead>
       <tr>
        <th>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</th>
        <th>‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</th>
        <th>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</th>
        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°</th>
        <th>‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô</th>
        <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
        <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
       </tr>
      
 </thead>
      <tbody id="historyTableBody"></tbody>
     </table>
    </div>
   </div>
   <footer class="bg-white mt-10 border-t">
    <div class="container mx-auto py-6 px-4 sm:px-6 lg:px-8 text-center text-gray-500 **text-xs sm:text-sm lg:text-base**">
        <p class="mb-1">
            ¬© 2...
  
  <script>
    // Configuration
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyRS1iie8d2Bj-jxh6n2Y7XcZBoVWOoNxtXIvA6p3rjyx_DnhUyUWR3TqmL7GYwD5Ybiw/exec';
    
    // Data storage
    let books = [];
    let members = [];
    let borrowRecords = [];
    let charts = {};
    let isConnected = false;

    // Configuration
    const defaultConfig = {
      library_name: "üìö ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡∏®‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ö‡∏•‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç",
      admin_name: "‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥",
      contact_info: "@2025 ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ ‡∏®‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ï‡∏≥‡∏ö‡∏•‡∏™‡∏±‡∏ô‡∏ï‡∏¥‡∏™‡∏∏‡∏Ç : ‡∏™‡∏Å‡∏£.‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏î‡∏≠‡∏¢‡∏´‡∏•‡πà‡∏≠ ‡πÇ‡∏ó‡∏£. 062-6834332",
      background_color: "#e8f5e9",
      surface_color: "#ffffff",
      text_color: "#1b5e20",
      primary_action: "#66bb6a",
      secondary_action: "#ffb74d"
    };
    
    // Update connection status
    function updateConnectionStatus(status) {
      const statusEl = document.getElementById('connectionStatus');
      const iconEl = document.getElementById('statusIcon');
      const textEl = document.getElementById('statusText');
      statusEl.className = 'connection-status';
      
      if (status === 'connected') {
        statusEl.classList.add('status-connected');
        iconEl.textContent = '‚úÖ';
        textEl.textContent = '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
        isConnected = true;
      } else if (status === 'syncing') {
        statusEl.classList.add('status-syncing');
        iconEl.textContent = 'üîÑ';
        textEl.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ã‡∏¥‡∏á‡∏Ñ‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
      } else {
        statusEl.classList.add('status-disconnected');
        iconEl.textContent = '‚ùå';
        textEl.textContent = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ';
        isConnected = false;
      }
    }
    
    // Show loading overlay
    function showLoading() {
      const overlay = document.createElement('div');
      overlay.className = 'loading-overlay';
      overlay.id = 'loadingOverlay';
      overlay.innerHTML = '<div class="loading-spinner"></div>';
      document.body.appendChild(overlay);
    }
    
    function hideLoading() {
      const overlay = document.getElementById('loadingOverlay');
      if (overlay) {
        overlay.remove();
      }
    }
    
    // POST request function using FormData (FIXED for robust connection)
    function scriptRequest(params) {
      return new Promise((resolve, reject) => {
        const formData = new FormData();
        Object.keys(params).forEach(key => {
          formData.append(key, params[key]);
        });
        
        // FIX: Replaced the unstable double-fetch (no-cors) with a direct, single POST request (standard CORS)
        fetch(SCRIPT_URL, { 
          method: 'POST', 
          body: formData, 
          // mode: 'cors' is assumed if not set, but is required for cross-origin
          // The Google Apps Script MUST be deployed as a Web App 
          // and return ContentService.createTextOutput(JSON.stringify(result)).setMimeType(ContentService.MimeType.JSON);
        })
        .then(response => {
           if (!response.ok) {
               throw new Error(`HTTP error! status: ${response.status}`);
           }
           return response.json(); 
        })
        .then(data => {
            if (data && data.success === false) {
                // Handle case where script ran but returned an error status (e.g., bad auth, script logic error)
                reject(new Error(data.error || 'Apps Script returned an error.'));
            } else {
                resolve(data);
            }
        })
        .catch(error => {
          console.error("Script Request Failed:", error);
          reject(error);
        });
      });
    }

    // Load data from Google Sheets (SIMPLIFIED and FIXED)
    async function loadDataFromSheets() {
      if (isConnected) return;
      showLoading();
      updateConnectionStatus('syncing');
      
      try {
        // Send a single request with action 'getData'
        const response = await scriptRequest({ action: 'getData' });
        
        if (response && response.success) {
          books = response.books || [];
          members = response.members || [];
          borrowRecords = response.borrowRecords || [];
          updateConnectionStatus('connected');
          updateAllViews();
          hideLoading();
          showToast('‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
          return true;
        } else {
          // If the script runs but returns success: false
          throw new Error(response?.error || 'Failed to load data (Apps Script returned an error).');
        }
      } catch (error) {
        // If the fetch itself fails (e.g., network error, CORS, or script error)
        console.error('Error loading data:', error);
        updateConnectionStatus('disconnected');
        hideLoading();
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets ‡πÑ‡∏î‡πâ: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö URL ‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Apps Script', 'error');
        return false;
      }
    }

    // Save data to Google Sheets
    async function saveToSheets(sheet, data) {
      try {
        updateConnectionStatus('syncing');
        // FIX: The save operation now uses the fixed scriptRequest
        const response = await scriptRequest({
          action: 'saveData',
          sheet: sheet,
          data: JSON.stringify(data)
        });
        if (response && response.success) {
          updateConnectionStatus('connected');
          return true;
        } else {
          throw new Error(response?.error || 'Failed to save data');
        }
      } catch (error) {
        console.error('Error saving data:', error);
        updateConnectionStatus('disconnected');
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Sheets ‡πÑ‡∏î‡πâ: ' + error.message, 'error');
        return false;
      }
    }

    // Delete data from Google Sheets
    async function deleteFromSheets(sheet, id) {
      try {
        updateConnectionStatus('syncing');
        // FIX: The delete operation now uses the fixed scriptRequest
        const response = await scriptRequest({
          action: 'deleteData',
          sheet: sheet,
          id: id
        });
        if (response && response.success) {
          updateConnectionStatus('connected');
          return true;
        } else {
          throw new Error(response?.error || 'Failed to delete data');
        }
      } catch (error) {
        console.error('Error deleting data:', error);
        updateConnectionStatus('disconnected');
        showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheets ‡πÑ‡∏î‡πâ: ' + error.message, 'error');
        return false;
      }
    }

    // Toast notification
    function showToast(message, type = 'success') {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);
      setTimeout(() => {
        toast.remove();
      }, 3000);
    }
    
    // Confirmation modal (for delete)
    function showConfirmModal(title, message, onConfirm) {
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay';
      overlay.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">${title}</div>
          <div class="modal-body">${message}</div>
          <div class="modal-buttons">
            <button class="button-secondary" onclick="this.closest('.modal-overlay').remove()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="button-danger" id="confirmBtn">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
          </div>
        </div>
      `;
      document.body.appendChild(overlay);
      document.getElementById('confirmBtn').onclick = () => {
        onConfirm();
        overlay.remove();
      };
      overlay.onclick = (e) => {
        if (e.target === overlay) {
          overlay.remove();
        }
      };
    }
    
    // Helper function to find an item by ID
    function findItem(array, id) {
      return array.find(item => item.id === id);
    }

    // Generic Edit Modal (for Book and Member)
    function showEditModal(title, formHtml, onSave) {
      const existingOverlay = document.getElementById('genericModalOverlay');
      if (existingOverlay) existingOverlay.remove();
      
      const overlay = document.createElement('div');
      overlay.className = 'modal-overlay';
      overlay.id = 'genericModalOverlay';
      overlay.innerHTML = `
        <div class="modal-content">
          <div class="modal-header">${title}</div>
          <form id="editForm">
            <div class="modal-body" style="margin-bottom: 0;">
              ${formHtml}
            </div>
            <div class="modal-buttons" style="margin-top: 20px;">
              <button type="button" class="button-secondary" onclick="this.closest('.modal-overlay').remove()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
              <button type="submit" class="button-primary" id="saveEditBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            </div>
          </form>
        </div>
      `;
      document.body.appendChild(overlay);

      const form = document.getElementById('editForm');
      form.onsubmit = async (e) => {
        e.preventDefault();
        const btn = document.getElementById('saveEditBtn');
        btn.disabled = true;
        btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
        await onSave();
        overlay.remove();
      };
      
      overlay.onclick = (e) => {
        if (e.target === overlay) {
          overlay.remove();
        }
      };
    }

    // Navigation
    function navigateTo(sectionId) {
      document.querySelectorAll('.content-section').forEach(section => {
        section.classList.remove('active');
      });
      document.getElementById(sectionId).classList.add('active');
      
      document.querySelectorAll('.nav-button').forEach(button => {
        button.classList.remove('active');
      });
      // The event object is usually available implicitly, but for safety in older browser or 
      // when called programmatically, we should use a passed argument or check if event exists.
      // Assuming this is always called from an event handler based on the original code
      const targetButton = event.target.closest('.nav-button');
      if (targetButton) {
          targetButton.classList.add('active');
      }

      // Update tables when navigating to their sections
      if (sectionId === 'books') updateBooksTable();
      if (sectionId === 'members') updateMembersTable();
      if (sectionId === 'history') updateHistoryTable();
      if (sectionId === 'borrow') {
        updateAvailableBooksList();
        // Set default dates for borrow form
        const today = new Date().toISOString().split('T')[0];
        const dueDate = new Date();
        dueDate.setDate(dueDate.getDate() + 7);
        document.getElementById('borrowDate').value = today;
        document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
      }
      if (sectionId === 'return') updateBorrowedBooksList();
    }

    // Core update function
    function updateAllViews() {
      updateDashboardStats();
      updateCharts();
      updateBooksTable();
      updateMembersTable();
      updateHistoryTable();
      updateAvailableBooksList();
      updateBorrowedBooksList();
    }

    // Dashboard updates
    function updateDashboardStats() {
      const totalAvailable = books.reduce((sum, book) => sum + parseInt(book.available), 0);
      const totalBorrowed = borrowRecords.filter(b => b.status === 'borrowed').length;
      
      const today = new Date().toISOString().split('T')[0];
      const todayBorrows = borrowRecords.filter(b => b.borrowDate === today && b.status === 'borrowed').length;
      
      const overdue = borrowRecords.filter(b => {
        if (b.status !== 'borrowed') return false;
        return new Date(b.dueDate) < new Date();
      });

      document.getElementById('totalBooks').textContent = books.length;
      document.getElementById('availableBooks').textContent = totalAvailable;
      document.getElementById('borrowedBooks').textContent = totalBorrowed;
      document.getElementById('overdueBooks').textContent = overdue.length;
      document.getElementById('totalMembers').textContent = members.length;
      document.getElementById('todayBorrows').textContent = todayBorrows;

      // Update overdue list
      const overdueList = document.getElementById('overdueList');
      if (overdue.length === 0) {
        overdueList.innerHTML = '<p style="color: #66bb6a; text-align: center; padding: 20px;">üéâ ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô</p>';
      } else {
        overdueList.innerHTML = overdue.map(item => {
          const book = books.find(b => b.id === item.bookId);
          const member = members.find(m => m.id === item.memberId);
          const daysOverdue = Math.floor((new Date() - new Date(item.dueDate)) / (1000 * 60 * 60 * 24));
          
          return `
            <div class="book-card">
              <div class="book-card-header">
                <div>
                  <div class="book-card-title">${book ? book.title : item.bookId}</div>
                  <div class="book-card-author">‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: ${member ? member.name : item.memberId}</div>
                </div>
                <span class="status-badge status-overdue">‡πÄ‡∏Å‡∏¥‡∏ô ${daysOverdue} ‡∏ß‡∏±‡∏ô</span>
              </div>
              <div class="book-card-info">
                <div class="book-card-info-item">
                  <span class="book-card-info-label">‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠:</span> ${item.bookId}
                </div>
                <div class="book-card-info-item">
                  <span class="book-card-info-label">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô:</span> ${item.dueDate}
                </div>
              </div>
            </div>
          `;
        }).join('');
      }
    }

    // Add book
    async function handleAddBook(event) {
      event.preventDefault();
      const bookId = document.getElementById('bookId').value;
      
      if (books.some(b => b.id === bookId)) {
        showToast('‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß', 'warning');
        return;
      }

      const quantity = parseInt(document.getElementById('bookQuantity').value);
      const book = {
        id: bookId,
        title: document.getElementById('bookTitle').value,
        author: document.getElementById('bookAuthor').value,
        category: document.getElementById('bookCategory').value,
        isbn: document.getElementById('bookISBN').value || '',
        quantity: quantity,
        available: quantity,
        timestamp: Date.now()
      };

      const btn = event.target.querySelector('button[type="submit"]');
      btn.disabled = true;
      btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
      
      const success = await saveToSheets('books', book);
      
      if (success) {
        books.push(book);
        updateAllViews();
        showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        event.target.reset();
      }
      
      btn.disabled = false;
      btn.textContent = '‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠';
    }

    // Add member
    async function handleAddMember(event) {
      event.preventDefault();
      const memberId = document.getElementById('memberId').value;
      
      if (members.some(m => m.id === memberId)) {
        showToast('‡∏°‡∏µ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß', 'warning');
        return;
      }
      
      const member = {
        id: memberId,
        name: document.getElementById('memberName').value,
        email: document.getElementById('memberEmail').value || '',
        phone: document.getElementById('memberPhone').value,
        type: document.getElementById('memberType').value,
        timestamp: Date.now()
      };

      const btn = event.target.querySelector('button[type="submit"]');
      btn.disabled = true;
      btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';
      
      const success = await saveToSheets('members', member);
      
      if (success) {
        members.push(member);
        updateAllViews();
        showToast('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        event.target.reset();
      }
      
      btn.disabled = false;
      btn.textContent = '‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å';
    }

    // Borrow book
    async function handleBorrow(event) {
      event.preventDefault();
      const memberId = document.getElementById('borrowMemberId').value;
      const bookId = document.getElementById('borrowBookId').value;
      
      const member = members.find(m => m.id === memberId);
      if (!member) {
        showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'warning');
        return;
      }
      
      const book = books.find(b => b.id === bookId);
      if (!book) {
        showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö', 'warning');
        return;
      }
      
      const alreadyBorrowed = borrowRecords.some(b => b.memberId === memberId && b.bookId === bookId && b.status === 'borrowed');
      if (alreadyBorrowed) {
        showToast('‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡πà‡∏°‡∏ô‡∏µ‡πâ‡∏≠‡∏¢‡∏π‡πà', 'warning');
        return;
      }
      
      if (parseInt(book.available) <= 0) {
        showToast('‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏•‡πà‡∏°‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß', 'warning');
        return;
      }
      
      const borrow = {
        id: 'BR' + Date.now(),
        memberId: memberId,
        bookId: bookId,
        bookTitle: book.title,
        borrowDate: document.getElementById('borrowDate').value,
        dueDate: document.getElementById('dueDate').value,
        returnDate: '',
        status: 'borrowed',
        notes: document.getElementById('borrowNotes').value || '',
        timestamp: Date.now()
      };

      const btn = event.target.querySelector('button[type="submit"]');
      btn.disabled = true;
      btn.textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

      const success = await saveToSheets('borrows', borrow);
      
      if (success) {
        // Update local book count and save
        book.available = parseInt(book.available) - 1;
        await saveToSheets('books', book); 
        
        borrowRecords.push(borrow);
        updateAllViews();
        showToast(`‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ${member.name} ‡∏¢‡∏∑‡∏° ${book.title}`, 'success');
        event.target.reset();
        
        // Reset default dates
        const today = new Date().toISOString().split('T')[0];
        const dueDate = new Date();
        dueDate.setDate(dueDate.getDate() + 7);
        document.getElementById('borrowDate').value = today;
        document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
      }
      
      btn.disabled = false;
      btn.textContent = 'üìñ ‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠';
    }

    // Return book
    function returnBook(borrowId) {
      const borrow = borrowRecords.find(b => b.id === borrowId);
      if (!borrow) return;

      showConfirmModal(
        '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠',
        `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠: ${borrow.bookTitle} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
        async () => {
          borrow.status = 'returned';
          borrow.returnDate = new Date().toISOString().split('T')[0];

          const success = await saveToSheets('borrows', borrow);
          
          if (success) {
            const book = books.find(b => b.id === borrow.bookId);
            if (book) {
              book.available = parseInt(book.available) + 1;
              await saveToSheets('books', book);
            }
            updateAllViews();
            showToast('‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
          }
        }
      );
    }
    
    // --------------------------------------------------------------------------------
    // NEW EDIT FUNCTIONS FOR BOOKS AND MEMBERS
    // --------------------------------------------------------------------------------

    // Edit Book Logic
    function editBook(bookId) {
      const book = findItem(books, bookId);
      if (!book) {
        showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', 'error');
        return;
      }
      const categoryOptions = [
        '‡∏ô‡∏¥‡∏¢‡∏≤‡∏¢', '‡∏Å‡∏≤‡∏£‡πå‡∏ï‡∏π‡∏ô', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ', '‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ', '‡∏™‡∏≤‡∏£‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡∏π‡πâ‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô',
        '‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö‡∏≠‡∏≤‡∏ä‡∏µ‡∏û', '‡∏™‡∏≤‡∏£‡∏∞‡∏ó‡∏±‡∏Å‡∏©‡∏∞‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï', '‡∏™‡∏≤‡∏£‡∏∞‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏™‡∏±‡∏á‡∏Ñ‡∏°', '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'
      ].map(cat => `<option value="${cat}" ${book.category === cat ? 'selected' : ''}>${cat}</option>`).join('');

      const formHtml = `
        <input type="hidden" id="editBookId" value="${book.id}">
        <div class="form-layout">
          <div class="input-group"><label>‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ *</label> <input type="text" id="editBookTitle" value="${book.title}" required></div>
          <div class="input-group"><label>‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á *</label> <input type="text" id="editBookAuthor" value="${book.author}" required></div>
          <div class="input-group"><label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà *</label> 
            <select id="editBookCategory" required>
              <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
              ${categoryOptions}
            </select>
          </div>
          <div class="input-group"><label>ISBN</label> <input type="text" id="editBookISBN" value="${book.isbn || ''}"></div>
          <div class="input-group"><label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î *</label> <input type="number" id="editBookQuantity" value="${book.quantity}" required min="1"></div>
          <div class="input-group"><label>‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏° (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)</label> <input type="number" value="${book.available}" disabled></div>
        </div>
        <p style="margin-top: 15px; font-size: 0.9em; color: #f57f17;">* ‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' ‡∏à‡∏∞‡∏™‡πà‡∏á‡∏ú‡∏•‡∏ï‡πà‡∏≠ '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°' ‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
      `;

      showEditModal(`‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠: ${book.title}`, formHtml, updateBookDetails);
    }

    // Save Book function
    async function updateBookDetails() {
      const id = document.getElementById('editBookId').value;
      const oldBook = findItem(books, id);
      const newQuantity = parseInt(document.getElementById('editBookQuantity').value);
      
      if (newQuantity < parseInt(oldBook.quantity) - parseInt(oldBook.available)) {
        showToast('‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏Å‡∏ß‡πà‡∏≤‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß', 'warning');
        return false; 
      }

      const quantityDiff = newQuantity - parseInt(oldBook.quantity);
      const newAvailable = parseInt(oldBook.available) + quantityDiff;

      const updatedBook = {
        id: id,
        title: document.getElementById('editBookTitle').value,
        author: document.getElementById('editBookAuthor').value,
        category: document.getElementById('editBookCategory').value,
        isbn: document.getElementById('editBookISBN').value,
        quantity: newQuantity,
        available: newAvailable,
        timestamp: oldBook.timestamp 
      };
      
      // Update local array
      const index = books.findIndex(b => b.id === id);
      if (index !== -1) {
          books[index] = updatedBook;
      }
      
      showLoading();
      const success = await saveToSheets('books', updatedBook);
      hideLoading();

      if (success) {
        updateAllViews();
        showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        return true;
      } else {
        // Revert local changes if saving fails
        if (index !== -1) {
            books[index] = oldBook;
        }
        updateAllViews(); 
        return false;
      }
    }

    // Edit Member Logic
    function editMember(memberId) {
      const member = findItem(members, memberId);
      if (!member) {
        showToast('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', 'error');
        return;
      }

      const typeOptions = [
        '‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤', '‡∏Ñ‡∏£‡∏π', '‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£', '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'
      ].map(type => `<option value="${type}" ${member.type === type ? 'selected' : ''}>${type}</option>`).join('');

      const formHtml = `
        <input type="hidden" id="editMemberId" value="${member.id}">
       <div class="form-layout">
          <div class="input-group"><label>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ)</label> <input type="text" value="${member.id}" disabled></div>
          <div class="input-group"><label>‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏• *</label> <input type="text" id="editMemberName" value="${member.name}" required></div>
          <div class="input-group"><label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label> <input type="email" id="editMemberEmail" value="${member.email || ''}"></div>
          <div class="input-group"><label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£ *</label> <input type="tel" id="editMemberPhone" value="${member.phone}" required></div>
          <div class="input-group"><label>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó *</label> 
            <select id="editMemberType" required>
              <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</option>
              ${typeOptions}
            </select>
          </div>
        </div>
      `;

      showEditModal(`‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: ${member.name}`, formHtml, updateMemberDetails);
    }

    // Save Member function
    async function updateMemberDetails() {
      const id = document.getElementById('editMemberId').value;
      const oldMember = findItem(members, id);

      const updatedMember = {
        id: id,
        name: document.getElementById('editMemberName').value,
        email: document.getElementById('editMemberEmail').value,
        phone: document.getElementById('editMemberPhone').value,
        type: document.getElementById('editMemberType').value,
        timestamp: oldMember.timestamp
      };
      
      // Update local array
      const index = members.findIndex(m => m.id === id);
      if (index !== -1) {
          members[index] = updatedMember;
      }

      showLoading();
      const success = await saveToSheets('members', updatedMember);
      hideLoading();

      if (success) {
        updateAllViews();
        showToast('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
        return true;
      } else {
        // Revert local changes if saving fails
        if (index !== -1) {
            members[index] = oldMember;
        }
        updateAllViews(); 
        return false;
      }
    }
    
    // --------------------------------------------------------------------------------
    // END NEW EDIT FUNCTIONS
    // --------------------------------------------------------------------------------

    // Delete functions
    function deleteBook(bookId) {
      const book = books.find(b => b.id === bookId);
      if (!book) return;
      
      const isBorrowed = borrowRecords.some(b => b.bookId === bookId && b.status === 'borrowed');
      if (isBorrowed) {
          showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÑ‡∏î‡πâ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà', 'error');
          return;
      }

      showConfirmModal(
        '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠',
        `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠: ${book.title} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
        async () => {
          const success = await deleteFromSheets('books', bookId);
          if (success) {
            books = books.filter(b => b.id !== bookId);
            updateAllViews();
            showToast('‡∏•‡∏ö‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
          }
        }
      );
    }

    function deleteMember(memberId) {
      const member = members.find(m => m.id === memberId);
      if (!member) return;
      
      const isBorrowing = borrowRecords.some(b => b.memberId === memberId && b.status === 'borrowed');
      if (isBorrowing) {
          showToast('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÑ‡∏î‡πâ‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏≤‡∏Å‡∏¢‡∏±‡∏á‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà', 'error');
          return;
      }

      showConfirmModal(
        '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å',
        `‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å: ${member.name} ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`,
        async () => {
          const success = await deleteFromSheets('members', memberId);
          if (success) {
            members = members.filter(m => m.id !== memberId);
            updateAllViews();
            showToast('‡∏•‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
          }
        }
      );
    }

    // Update tables
    function updateBooksTable() {
      const searchTerm = document.getElementById('searchBooks')?.value.toLowerCase() || '';
      
      const filteredBooks = books.filter(book => 
        book.id.toLowerCase().includes(searchTerm) || 
        book.title.toLowerCase().includes(searchTerm) || 
        book.author.toLowerCase().includes(searchTerm) ||
        book.category.toLowerCase().includes(searchTerm)
      );

      const tbody = document.getElementById('booksTableBody');
      if (filteredBooks.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8" class="empty-message">
              <div class="empty-icon">üìö</div>
              <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h3>
              <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏´‡πâ‡∏≠‡∏á‡∏™‡∏°‡∏∏‡∏î‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
            </td>
          </tr>
        `;
        return;
      }
      
      // MODIFIED: Added Edit button
      tbody.innerHTML = filteredBooks.map(book => `
        <tr>
          <td>${book.id}</td>
          <td>${book.title}</td>
          <td>${book.author}</td>
          <td>${book.category}</td>
          <td>${book.isbn || '-'}</td>
          <td>${book.quantity}</td>
          <td>${book.available}</td>
          <td>
            <div class="action-button-group">
              <button class="button-secondary" onclick="editBook('${book.id}')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button class="button-danger" onclick="deleteBook('${book.id}')">üóëÔ∏è ‡∏•‡∏ö</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function updateMembersTable() {
      const searchTerm = document.getElementById('searchMembers')?.value.toLowerCase() || '';
      const filterType = document.getElementById('filterMemberType')?.value || '';
      
      const filteredMembers = members.filter(member => {
        const matchSearch = member.id.toLowerCase().includes(searchTerm) || member.name.toLowerCase().includes(searchTerm);
        const matchType = !filterType || member.type === filterType;
        return matchSearch && matchType;
      });

      const tbody = document.getElementById('membersTableBody');
      if (filteredMembers.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="6" class="empty-message">
              <div class="empty-icon">üë•</div>
              <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h3>
              <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢</p>
            </td>
          </tr>
        `;
        return;
      }
      
      // MODIFIED: Added Edit button
      tbody.innerHTML = filteredMembers.map(member => `
        <tr>
          <td>${member.id}</td>
          <td>${member.name}</td>
          <td>${member.email || '-'}</td>
          <td>${member.phone}</td>
          <td>${member.type}</td>
          <td>
            <div class="action-button-group">
              <button class="button-secondary" onclick="editMember('${member.id}')">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
              <button class="button-danger" onclick="deleteMember('${member.id}')">üóëÔ∏è ‡∏•‡∏ö</button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    function updateHistoryTable() {
      const searchTerm = document.getElementById('searchHistory')?.value.toLowerCase() || '';
      const filterStatus = document.getElementById('filterStatus')?.value || '';

      let filteredHistory = borrowRecords.filter(record => {
        const matchSearch = record.memberId.toLowerCase().includes(searchTerm) || record.bookId.toLowerCase().includes(searchTerm) || record.bookTitle.toLowerCase().includes(searchTerm);
        
        let matchStatus = true;
        if (filterStatus === 'borrowed') {
          matchStatus = record.status === 'borrowed' && new Date(record.dueDate) >= new Date();
        } else if (filterStatus === 'returned') {
          matchStatus = record.status === 'returned';
        } else if (filterStatus === 'overdue') {
          matchStatus = record.status === 'borrowed' && new Date(record.dueDate) < new Date();
        }
        
        return matchSearch && matchStatus;
      });

      // Sort by newest first
      filteredHistory.sort((a, b) => b.timestamp - a.timestamp);

      const tbody = document.getElementById('historyTableBody');
      if (filteredHistory.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="8" class="empty-message">
              <div class="empty-icon">üìã</div>
              <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô</h3>
              <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏¢‡∏∑‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</p>
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = filteredHistory.map(record => {
        let statusBadge = '';
        let statusClass = '';
        
        if (record.status === 'returned') {
          statusBadge = '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
          statusClass = 'status-returned';
        } else if (new Date(record.dueDate) < new Date()) {
          statusBadge = '‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î';
          statusClass = 'status-overdue';
        } else {
          statusBadge = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°';
          statusClass = 'status-borrowed';
        }

        return `
          <tr>
            <td>${record.memberId}</td>
            <td>${record.bookId}</td>
            <td>${record.bookTitle}</td>
            <td>${record.borrowDate}</td>
            <td>${record.dueDate}</td>
            <td>${record.returnDate || '-'}</td>
            <td><span class="status-badge ${statusClass}">${statusBadge}</span></td>
            <td>
              <div class="action-button-group">
                ${record.status === 'borrowed' ? `<button class="button-success" onclick="returnBook('${record.id}')">üì• ‡∏Ñ‡∏∑‡∏ô</button>` : ''}
              </div>
            </td>
          </tr>
        `;
      }).join('');
    }

    function updateAvailableBooksList() {
      const searchTerm = document.getElementById('searchAvailableBooks')?.value.toLowerCase() || '';
      const filterCategory = document.getElementById('filterCategory')?.value || '';
      
      let availableBooks = books.filter(book => parseInt(book.available) > 0);
      
      availableBooks = availableBooks.filter(book => {
        const matchSearch = book.id.toLowerCase().includes(searchTerm) || book.title.toLowerCase().includes(searchTerm) || book.author.toLowerCase().includes(searchTerm);
        const matchCategory = !filterCategory || book.category === filterCategory;
        return matchSearch && matchCategory;
      });

      const container = document.getElementById('availableBooksList');
      if (availableBooks.length === 0) {
        container.innerHTML = '<div class="empty-message"><div class="empty-icon">üìñ</div><h3>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°</h3><p>‡∏≠‡∏≤‡∏à‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</p></div>';
        return;
      }

      container.innerHTML = availableBooks.map(book => `
        <div class="book-card">
          <div class="book-card-header">
            <div>
              <div class="book-card-title">${book.title}</div>
              <div class="book-card-author">‡∏ú‡∏π‡πâ‡πÅ‡∏ï‡πà‡∏á: ${book.author}</div>
            </div>
            <span class="status-badge status-available">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°: ${book.available} ‡πÄ‡∏•‡πà‡∏°</span>
          </div>
          <div class="book-card-info">
            <div class="book-card-info-item">
              <span class="book-card-info-label">‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠:</span> ${book.id}
            </div>
            <div class="book-card-info-item">
              <span class="book-card-info-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà:</span> ${book.category}
            </div>
            <div class="book-card-info-item">
              <span class="book-card-info-label">ISBN:</span> ${book.isbn || '-'}
            </div>
            <div class="book-card-info-item">
              <span class="book-card-info-label">‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏´‡πâ‡∏¢‡∏∑‡∏°:</span> ${book.available} ‡πÄ‡∏•‡πà‡∏°
            </div>
          </div>
        </div>
      `).join('');
    }

    function updateBorrowedBooksList() {
      const searchTerm = document.getElementById('searchBorrowed')?.value.toLowerCase() || '';
      let borrows = borrowRecords.filter(b => b.status === 'borrowed');
      
      borrows = borrows.filter(borrow => 
        borrow.memberId.toLowerCase().includes(searchTerm) || 
        borrow.bookId.toLowerCase().includes(searchTerm) || 
        borrow.bookTitle.toLowerCase().includes(searchTerm)
      );

      // Sort by due date, overdue first
      borrows.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));

      const container = document.getElementById('borrowedBooksList');
      
      if (borrows.length === 0) {
        container.innerHTML = '<div class="empty-message"><div class="empty-icon">üìñ</div><h3>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏¢‡∏∑‡∏°</h3></div>';
        return;
      }

      container.innerHTML = borrows.map(borrow => {
        const book = books.find(b => b.id === borrow.bookId);
        const member = members.find(m => m.id === borrow.memberId);
        const isOverdue = new Date(borrow.dueDate) < new Date();
        
        return `
          <div class="book-card">
            <div class="book-card-header">
              <div>
                <div class="book-card-title">${borrow.bookTitle}</div>
                <div class="book-card-author">‡∏¢‡∏∑‡∏°‡πÇ‡∏î‡∏¢: ${member ? member.name : borrow.memberId}</div>
              </div>
              <span class="status-badge ${isOverdue ? 'status-overdue' : 'status-borrowed'}">
                ${isOverdue ? '‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î' : 'üìñ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°'}
              </span>
            </div>
            <div class="book-card-info">
              <div class="book-card-info-item">
                <span class="book-card-info-label">‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠:</span> ${borrow.bookId}
              </div>
              <div class="book-card-info-item">
                <span class="book-card-info-label">‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å:</span> ${borrow.memberId}
              </div>
              <div class="book-card-info-item">
                <span class="book-card-info-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°:</span> ${borrow.borrowDate}
              </div>
              <div class="book-card-info-item">
                <span class="book-card-info-label">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô:</span> ${borrow.dueDate}
              </div>
            </div>
            <div style="margin-top: 15px;">
              <button class="button-success" onclick="returnBook('${borrow.id}')">üì• ‡∏Ñ‡∏∑‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠</button>
            </div>
          </div>
        `;
      }).join('');
    }

    // Search functions
    function searchBooks() { updateBooksTable(); }
    function searchMembers() { updateMembersTable(); }
    function searchHistory() { updateHistoryTable(); }
    function searchAvailableBooks() { updateAvailableBooksList(); }
    function searchBorrowedBooks() { updateBorrowedBooksList(); }

    // Export history
    function exportHistory() {
      if (borrowRecords.length === 0) {
        showToast('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Export', 'warning');
        return;
      }

      const headers = ['‡∏£‡∏´‡∏±‡∏™‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å', '‡∏£‡∏´‡∏±‡∏™‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°', '‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏∑‡∏ô', '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏∑‡∏ô', '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞'];
      
      const csvContent = borrowRecords.map(record => {
        let status = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°';
        if (record.status === 'returned') {
          status = '‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß';
        } else if (record.status === 'borrowed' && new Date(record.dueDate) < new Date()) {
          status = '‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î';
        }
        
        return [
          record.memberId,
          record.bookId,
          `"${record.bookTitle.replace(/"/g, '""')}"`, // Handle quotes in title
          record.borrowDate,
          record.dueDate,
          record.returnDate || '',
          status
        ].join(',');
      }).join('\n');

      const csv = headers.join(',') + '\n' + csvContent;
      const blob = new Blob(["\ufeff", csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement("a");

      if (link.download !== undefined) {
        const url = URL.createObjectURL(blob);
        link.setAttribute("href", url);
        link.setAttribute("download", `library_history_${new Date().toISOString().split('T')[0]}.csv`);
        link.style.visibility = 'hidden';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showToast('Export ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
      } else {
        showToast('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£ Export', 'error');
      }
    }
    
    // Chart functions
    function initializeCharts() {
      const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              precision: 0
            }
          }
        },
        plugins: {
          legend: {
            display: false
          }
        }
      };

      // Borrow Chart
      const borrowCtx = document.getElementById('borrowChart').getContext('2d');
      if (charts.borrow) charts.borrow.destroy(); // Destroy previous instance to avoid memory leak
      charts.borrow = new Chart(borrowCtx, {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°',
            data: [],
            backgroundColor: 'rgba(102, 187, 106, 0.5)',
            borderColor: '#66bb6a',
            borderWidth: 2,
            tension: 0.4
          }]
        },
        options: chartOptions
      });

      // Popular Chart
      const popularCtx = document.getElementById('popularChart').getContext('2d');
      if (charts.popular) charts.popular.destroy(); // Destroy previous instance
      charts.popular = new Chart(popularCtx, {
        type: 'bar',
        data: {
          labels: [],
          datasets: [{
            label: '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏£‡∏ß‡∏°',
            data: [],
            backgroundColor: '#ffb74d',
          }]
        },
        options: {
          ...chartOptions,
          indexAxis: 'y' 
        }
      });
    }

    // Update charts
    function updateCharts() {
      if (!charts.borrow || !charts.popular) return;

      // Borrow chart - last 7 days
      const last7Days = [];
      const borrowCounts = [];
      for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        const dateStr = date.toISOString().split('T')[0];
        // Format the date for display (e.g., "1 ‡∏ò.‡∏Ñ.")
        const day = date.getDate();
        const month = date.getMonth() + 1;
        const displayDate = `${day}/${month}`;
        
        last7Days.push(displayDate);
        borrowCounts.push(borrowRecords.filter(b => b.borrowDate === dateStr).length);
      }
      charts.borrow.data.labels = last7Days;
      charts.borrow.data.datasets[0].data = borrowCounts;
      charts.borrow.update();

      // Popular books chart
      const bookCounts = {};
      borrowRecords.forEach(b => {
        bookCounts[b.bookTitle] = (bookCounts[b.bookTitle] || 0) + 1;
      });

      const topBooks = Object.entries(bookCounts)
        .sort((a, b) => b[1] - a[1])
        .slice(0, 10);
        
      charts.popular.data.labels = topBooks.map(b => b[0]);
      charts.popular.data.datasets[0].data = topBooks.map(b => b[1]);
      charts.popular.update();
    }

    // Element SDK initialization
    async function onConfigChange(config) {
      document.getElementById('headerTitle').textContent = config.library_name || defaultConfig.library_name;
      document.getElementById('headerSubtitle').textContent = config.admin_name || defaultConfig.admin_name;
      document.querySelector('footer p.mb-1').textContent = config.contact_info || defaultConfig.contact_info;
      
      // Update primary colors in CSS variables for dynamic theming (optional, based on your CSS setup)
      // document.documentElement.style.setProperty('--primary-color', config.primary_action);
      // document.documentElement.style.setProperty('--secondary-color', config.secondary_action);
    }
    
    // Main initialization
    function initializeApp() {
      // Ensure all initial table data loads on start
      updateAllViews();
      
      // Load configuration and data
      if (typeof elementSDK !== 'undefined') {
        elementSDK.config.onConfigChange(onConfigChange);
      } else {
        onConfigChange(defaultConfig);
      }

      // Set default dates for borrow form
      const today = new Date().toISOString().split('T')[0];
      const dueDate = new Date();
      dueDate.setDate(dueDate.getDate() + 7);
      document.getElementById('borrowDate').value = today;
      document.getElementById('dueDate').value = dueDate.toISOString().split('T')[0];
      
      initializeCharts();
      loadDataFromSheets();
    }

    // Initialize when page loads
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initializeApp);
    } else {
      initializeApp();
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a712e5797d5732b',t:'MTc2NDU3NzM5MS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else a.addEventListener('load',c)}})();</script>
 </body>
</html>
